<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>–ê—ç—Ä–æ–¥—Ä—É–≥</title>

  <style>
    :root{
      --bgTop:#0b4f87;
      --bgMid:#083a6d;
      --bgBot:#062a55;

      --text:#fff;
      --muted:rgba(255,255,255,.72);

      --bubble-bot: rgba(255,255,255,.14);
      --bubble-user:#f28a2a;

      --stroke: rgba(255,255,255,.14);

      --input-bg: rgba(255,255,255,.16);
      --input-stroke: rgba(255,255,255,.16);

      --btn-bg: rgba(255,255,255,.10);
      --btn-stroke: rgba(255,255,255,.18);

      --overlay: rgba(0,0,0,.38);
      --panel: rgba(7, 40, 80, .92);
      --panel-stroke: rgba(255,255,255,.14);

      --drawer: rgba(7, 32, 66, .96);

      --radius:18px;

      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);

      --header-h: 88px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 900px at 35% 25%, var(--bgTop) 0%, var(--bgMid) 45%, var(--bgBot) 100%);
      overflow:hidden;
    }

    .app{ height:100%; display:flex; flex-direction:column; }

    header{
      width:100%;
      height: calc(var(--header-h) + var(--safe-top));
      padding: calc(14px + var(--safe-top)) 18px 12px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(0,0,0,.14), rgba(0,0,0,0));
      backdrop-filter: blur(6px);
      position:relative;
      z-index:2;
      display:block;
    }
    header .wrap{
      width:100%;
      
      margin: 0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .icon-btn{
      width:46px;height:46px;
      border-radius:16px;
      border:1px solid var(--btn-stroke);
      background: var(--btn-bg);
      display:grid;
      place-items:center;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
      cursor:pointer;
      padding:0;
    }
    .icon-btn img{ width:22px;height:22px; object-fit:contain; display:block; }
    .brand{ display:flex; align-items:center; }
    .brand img{ height:22px; width:auto; display:block; }

    .titlebar{
      width:100%;
      max-width: 920px;
      margin: 0 auto;
      padding: 10px 20px 6px;
    }
    .titlebar h1{
      margin:0;
      font-size: 40px;
      font-weight: 800;
      letter-spacing:.2px;
      line-height:1.05;
    }

    .chat{
      width:100%;
      max-width: 920px;
      margin: 0 auto;
      flex:1;
      display:flex;
      flex-direction:column;
      min-height:0;
      padding: 0 16px;
      position:relative;
    }

    .messages{
      flex:1;
      min-height:0;
      overflow:auto;
      padding: 8px 0 12px;
      -webkit-overflow-scrolling: touch;
      scroll-behavior:smooth;
    }
    .messages::-webkit-scrollbar{ width:8px; }
    .messages::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.18);
      border-radius: 10px;
    }

    .empty-hint{
      margin: 18px 0 0;
      padding: 14px 14px;
      border: 1px dashed rgba(255,255,255,.18);
      border-radius: 16px;
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.78);
      line-height: 1.35;
    }

    .msg{ margin: 18px 0; display:flex; flex-direction:column; gap:6px; }
    .msg.bot{ align-items:flex-start; }
    .msg.user{ align-items:flex-end; }

    .label{
      font-size: 11px;
      letter-spacing: .6px;
      text-transform: uppercase;
      color: rgba(255,255,255,.55);
      padding: 0 6px;
    }

    .bubble{
      max-width: 78%;
      padding: 14px 16px;
      border-radius: var(--radius);
      border: 1px solid var(--stroke);
      box-shadow: 0 10px 22px rgba(0,0,0,.14);
      backdrop-filter: blur(6px);
      line-height: 1.35;
      font-size: 16px;
      white-space: pre-wrap;
      word-break: break-word;
    }
    .bot .bubble{ background: var(--bubble-bot); border-bottom-left-radius: 10px; }
    .user .bubble{ background: var(--bubble-user); border-color: rgba(255,255,255,.08); border-bottom-right-radius: 10px; }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      padding: 0 6px;
      margin-top: 4px;
    }
    .chip{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 14px;
      cursor:pointer;
      box-shadow: 0 10px 20px rgba(0,0,0,.12);
      user-select:none;
    }
    .chip:active{ transform: translateY(1px); }

    /* ===== movie cards inside bot bubble ===== */
    .movieBlockTitle{
      font-weight: 900;
      font-size: 16px;
      margin: 0 0 10px;
      letter-spacing:.2px;
    }
    .movieCards{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .movieCard{
      display:flex;
      gap:12px;
      padding: 10px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      box-shadow: 0 12px 22px rgba(0,0,0,.12);
    }
    .moviePoster{
      width:56px;
      height:78px;
      border-radius: 10px;
      overflow:hidden;
      flex: 0 0 auto;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
    }
    .moviePoster img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
    }
    .movieMeta{ display:flex; flex-direction:column; gap:4px; min-width:0; }
    .movieName{
      font-weight: 900;
      font-size: 15px;
      line-height: 1.15;
      margin:0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .movieLine{
      font-size: 13px;
      color: rgba(255,255,255,.80);
      line-height: 1.2;
      margin:0;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .movieDesc{
      font-size: 13px;
      color: rgba(255,255,255,.74);
      line-height: 1.25;
      margin: 2px 0 0;
      display:-webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow:hidden;
    }
    .tagRow{
      display:flex;
      gap:6px;
      flex-wrap:wrap;
      margin-top: 4px;
    }
    .tag{
      font-size: 12px;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.86);
    }

    /* ===== Action buttons row ABOVE input ===== */
    .actionRow{
      display:flex;
      gap:12px;
      padding: 8px 0 10px;
      align-items:stretch;
    }
    .actionBtn{
      flex:1;
      height:44px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      box-shadow: 0 10px 20px rgba(0,0,0,.12);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      font-size: 14px;
      font-weight: 800;
      user-select:none;
      white-space:nowrap;
      padding: 0 14px;
    }
    .actionBtn:active{ transform: translateY(1px); }
    .actionBtn.orange{
      background: var(--bubble-user);
      border-color: rgba(255,255,255,.12);
      color:#fff;
    }
    .actionBtn.voice-on{
      outline: 2px solid rgba(242,138,42,.55);
    }

    /* ===== composer ===== */
    .composer{
      padding: 0 0 calc(12px + var(--safe-bottom));
      position:relative;
      z-index:1;
    }
    .inputRow{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .plus{
      width:54px;height:54px;
      border-radius: 16px;
      border: 1px solid var(--btn-stroke);
      background: rgba(255,255,255,.10);
      display:grid;
      place-items:center;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
      cursor:pointer;
      padding:0;
    }
    .plus img{ width:22px;height:22px; display:block; }

    .input{
      flex:1;
      height:54px;
      border-radius: 18px;
      border: 1px solid var(--input-stroke);
      background: var(--input-bg);
      color: var(--text);
      outline:none;
      padding: 0 16px;
      font-size: 17px;
      box-shadow: 0 10px 22px rgba(0,0,0,.16);
    }
    .input::placeholder{ color: rgba(255,255,255,.70); }

    .send{
      width:56px;height:54px;
      border-radius: 18px;
      border:none;
      background: var(--bubble-user);
      box-shadow: 0 12px 24px rgba(0,0,0,.22);
      display:grid;
      place-items:center;
      cursor:pointer;
      padding:0;
    }
    .send img{ width:22px;height:22px; display:block; }

    /* ===== popup ===== */
    .overlay{
      position:absolute;
      inset:0;
      background: var(--overlay);
      backdrop-filter: blur(4px);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease;
      z-index:10;
    }
    .overlay.open{ opacity:1; pointer-events:auto; }

    .sheet{
      position:absolute;
      left: 16px;
      right: 16px;
      bottom: calc(12px + 44px + 10px + 54px + 24px + var(--safe-bottom));
      border-radius: 22px;
      border: 1px solid var(--panel-stroke);
      background: var(--panel);
      box-shadow: 0 24px 60px rgba(0,0,0,.28);
      padding: 14px;
      transform: translateY(10px);
      opacity:0;
      transition: transform .18s ease, opacity .18s ease;
      max-width: 920px;
      margin: 0 auto;
    }
    .overlay.open .sheet{ transform: translateY(0); opacity:1; }

    .sheet-title{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding: 4px 4px 10px;
    }
    .sheet-title h2{
      margin:0;
      font-size: 28px;
      font-weight: 900;
      letter-spacing:.2px;
      color:#fff;
    }
    .sheet-title p{
      margin:6px 0 0;
      color: rgba(255,255,255,.78);
      font-size: 18px;
      line-height: 1.25;
    }
    .sheet-close{
      width:52px;height:52px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.92);
      cursor:pointer;
      font-size: 30px;
      line-height: 1;
      display:grid;
      place-items:center;
    }

    .actions{ display:grid; grid-template-columns: 1fr; gap:12px; margin-top: 10px; }
    .action-card{
      width:100%;
      text-align:left;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.10);
      border-radius: 22px;
      padding: 16px 16px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:12px;
      color:#fff;
    }
    .action-card:active{ transform: translateY(1px); }
    .action-name{ font-weight: 900; font-size: 22px; line-height: 1.1; color:#fff; }
    .action-desc{ font-size: 18px; color: rgba(255,255,255,.78); line-height: 1.2; }

    /* ===== Drawer ===== */
    .drawerOverlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.42);
      backdrop-filter: blur(4px);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease;
      z-index:30;
    }
    .drawerOverlay.open{ opacity:1; pointer-events:auto; }

    .drawer{
      position:absolute;
      top:0; left:0;
      height:100%;
      width:min(360px, 86vw);
      padding: calc(18px + var(--safe-top)) 16px calc(16px + var(--safe-bottom));
      background: var(--drawer);
      border-right: 1px solid rgba(255,255,255,.12);
      box-shadow: 18px 0 40px rgba(0,0,0,.30);
      transform: translateX(-10px);
      opacity:0;
      transition: transform .18s ease, opacity .18s ease;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .drawerOverlay.open .drawer{ transform: translateX(0); opacity:1; }

    .drawerTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding-bottom: 6px;
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .drawerTitle{ font-size: 20px; font-weight: 900; letter-spacing:.2px; }
    .drawerClose{
      width:44px;height:44px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color:#fff;
      font-size: 28px;
      line-height: 1;
      cursor:pointer;
      display:grid;
      place-items:center;
    }

    .nav{ display:flex; flex-direction:column; gap:10px; padding-top: 6px; }
    .navItem{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08);
      border-radius: 18px;
      padding: 14px 14px;
      cursor:pointer;
      user-select:none;
    }
    .navItem.active{
      background: rgba(242,138,42,.20);
      border-color: rgba(242,138,42,.40);
    }
    .navItem .name{ font-size: 16px; font-weight: 900; }
    .navItem .sub{ font-size: 13px; color: rgba(255,255,255,.70); margin-top: 3px; }

    .drawerFooter{
      margin-top:auto;
      border-top: 1px solid rgba(255,255,255,.10);
      padding-top: 14px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .langRow{ display:flex; gap:10px; flex-wrap:wrap; }
    .langBtn{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color:#fff;
      border-radius: 999px;
      padding: 10px 12px;
      cursor:pointer;
      font-weight: 800;
      font-size: 13px;
    }
    .langBtn.active{
      background: rgba(242,138,42,.22);
      border-color: rgba(242,138,42,.42);
    }

    @media (min-width: 820px) and (orientation: landscape){
      .bubble{ max-width: 62%; }
      .titlebar h1{ font-size: 44px; }
      .sheet{ left: 16px; right: 16px; }
    }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="wrap">
        <button id="burger" class="icon-btn" type="button" aria-label="–ú–µ–Ω—é">
          <img src="Icon/Burger-menu.svg" alt="" />
        </button>

        <div class="brand" aria-label="Aeroflot">
          <img src="Logo/CMYK.svg" alt="AEROFLOT" />
        </div>
      </div>
    </header>

    <div class="titlebar">
      <h1 id="titleH1">–ê—ç—Ä–æ–¥—Ä—É–≥</h1>
    </div>

    <main class="chat">
      <div id="messages" class="messages" role="log" aria-live="polite" aria-relevant="additions">
        <div id="emptyHint" class="empty-hint"></div>
      </div>

      <div class="actionRow" aria-label="–ë—ã—Å—Ç—Ä—ã–µ –∫–Ω–æ–ø–∫–∏">
        <button id="crewBtnFixed" class="actionBtn orange" type="button"></button>
        <button id="voiceBtn" class="actionBtn" type="button"></button>
      </div>

      <div class="composer">
        <div class="inputRow">
          <button id="plus" class="plus" type="button" aria-label="–°—Ü–µ–Ω–∞—Ä–∏–∏">
            <img src="Icon/Plus.svg" alt="" />
          </button>

          <input id="input" class="input" type="text" autocomplete="off" />

          <button id="send" class="send" type="button" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">
            <img src="Icon/TextButton/arrow-up_20x20.svg" alt="" />
          </button>
        </div>
      </div>

      <!-- Scenarios sheet -->
      <div id="overlay" class="overlay" aria-hidden="true">
        <div class="sheet" role="dialog" aria-label="–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å –≤ –ø–æ–ª—ë—Ç–µ">
          <div class="sheet-title">
            <div>
              <h2 id="sheetTitle"></h2>
              <p id="sheetSubtitle"></p>
            </div>
            <button id="closeSheet" class="sheet-close" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
          </div>

          <div class="actions">
            <button class="action-card" type="button" data-action="watch">
              <div style="display:flex; flex-direction:column; gap:6px;">
                <div class="action-name" id="sheetWatchTitle"></div>
                <div class="action-desc" id="sheetWatchDesc"></div>
              </div>
            </button>

            <button class="action-card" type="button" data-action="sleep">
              <div style="display:flex; flex-direction:column; gap:6px;">
                <div class="action-name" id="sheetSleepTitle"></div>
                <div class="action-desc" id="sheetSleepDesc"></div>
              </div>
            </button>

            <button class="action-card" type="button" data-action="flyover">
              <div style="display:flex; flex-direction:column; gap:6px;">
                <div class="action-name" id="sheetFlyTitle"></div>
                <div class="action-desc" id="sheetFlyDesc"></div>
              </div>
            </button>

            <button class="action-card" type="button" data-action="aircraft">
              <div style="display:flex; flex-direction:column; gap:6px;">
                <div class="action-name" id="sheetAirTitle"></div>
                <div class="action-desc" id="sheetAirDesc"></div>
              </div>
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Drawer -->
  <div id="drawerOverlay" class="drawerOverlay" aria-hidden="true">
    <aside class="drawer" role="dialog" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">
      <div class="drawerTop">
        <div class="drawerTitle" id="drawerTitle"></div>
        <button id="drawerClose" class="drawerClose" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
      </div>

      <nav class="nav">
        <div class="navItem active" data-page="aerofriend">
          <div class="name" id="navAerofriend"></div>
          <div class="sub" id="navAerofriendSub"></div>
        </div>

        <div class="navItem" data-page="entertainment">
          <div class="name" id="navEnt"></div>
          <div class="sub" id="navEntSub"></div>
        </div>

        <div class="navItem" data-page="map3d">
          <div class="name" id="navMap"></div>
          <div class="sub" id="navMapSub"></div>
        </div>
      </nav>

      <div class="drawerFooter">
        <div style="font-weight:900; letter-spacing:.2px;" id="langTitle"></div>
        <div class="langRow">
          <button class="langBtn active" data-lang="ru" type="button">–†—É—Å—Å–∫–∏–π</button>
          <button class="langBtn" data-lang="en" type="button">English</button>
          <button class="langBtn" data-lang="tr" type="button">T√ºrk√ße</button>
        </div>
      </div>
    </aside>
  </div>

  <script>
    // =========================
    // NAV links
    // =========================
    const NAV_LINKS = {
      entertainment: "https://sedan-sauna-39315755.figma.site",
      map3d: "https://develop-airplane-volna-irs.igatec.com/map/"
    };

    // =========================
    // i18n
    // =========================
    let LANG = "ru";

    const I18N = {
      ru: {
        title: "–ê—ç—Ä–æ–¥—Ä—É–≥",
        placeholder: "–°–ø—Ä–æ—Å–∏ –º–µ–Ω—è",
        emptyHint: "–ù–∞–∂–º–∏—Ç–µ ¬´+¬ª –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å ‚Äî —è –ø–æ–º–æ–≥—É –ø–æ —Ö–æ–¥—É –ø–æ–ª—ë—Ç–∞.",
        quickCrew: "–°–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ä—Ç–ø—Ä–æ–≤–æ–¥–Ω–∏–∫—É",
        voiceStart: "–ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å",
        voiceStop: "–ü—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å",
        drawerTitle: "–ù–∞–≤–∏–≥–∞—Ü–∏—è",
        langTitle: "–Ø–∑—ã–∫",

        navAerofriend: "–ê—ç—Ä–æ–¥—Ä—É–≥",
        navAerofriendSub: "–ß–∞—Ç-–ø–æ–º–æ—â–Ω–∏–∫ –≤ –ø–æ–ª—ë—Ç–µ",
        navEnt: "–¶–µ–Ω—Ç—Ä —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏–π",
        navEntSub: "–§–∏–ª—å–º—ã, –º—É–∑—ã–∫–∞, –∏–≥—Ä—ã",
        navMap: "3D-–∫–∞—Ä—Ç–∞",
        navMapSub: "–ú–∞—Ä—à—Ä—É—Ç –≤ –æ–±—ä—ë–º–µ",

        sheetTitle: "–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å –≤ –ø–æ–ª—ë—Ç–µ",
        sheetSubtitle: "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–π ‚Äî —è –∑–∞–¥–∞–º –ø–∞—Ä—É –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂—É –≤–∞—Ä–∏–∞–Ω—Ç.",
        sheetWatchTitle: "üé¨ –ü–æ–¥–±–æ—Ä–∫–∞ –Ω–∞ —ç—Ç–æ—Ç —Ä–µ–π—Å",
        sheetWatchDesc: "–§–∏–ª—å–º –∏–ª–∏ —Å–µ—Ä–∏–∞–ª –ø–æ–¥ –≤–∫—É—Å –∏ –≤—Ä–µ–º—è.",
        sheetSleepTitle: "üåô –ú—è–≥–∫–æ —É—Å–Ω—É—Ç—å",
        sheetSleepDesc: "–î—ã—Ö–∞–Ω–∏–µ –∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ.",
        sheetFlyTitle: "üó∫Ô∏è –ú–∞—Ä—à—Ä—É—Ç –∏ –≥–¥–µ –º—ã",
        sheetFlyDesc: "–ì–æ—Ä–æ–¥–∞ –ø–æ –º–∞—Ä—à—Ä—É—Ç—É –∏ —á—Ç–æ –ø–æ–¥ –Ω–∞–º–∏.",
        sheetAirTitle: "‚úàÔ∏è –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –æ —Å–∞–º–æ–ª—ë—Ç–µ",
        sheetAirDesc: "–°–∫–æ—Ä–æ—Å—Ç—å, –≤—ã—Å–æ—Ç–∞, —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å.",

        errPick: "–ü—Ä–æ—Å—Ç–∏—Ç–µ, –Ω–µ –ø–æ–Ω—è–ª, —á—Ç–æ –≤—ã –∏–º–µ–ª–∏ –≤–≤–∏–¥—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞",

        labels: { you: "–í—ã", bot: "–ê–≠–†–û–î–†–£–ì" },

        // —Å—Ü–µ–Ω–∞—Ä–∏–∏
        hi: "–ü—Ä–∏–≤–µ—Ç, —á–µ–º —Ç–µ–±–µ –ø–æ–º–æ—á—å?",
        mainChips: {
          watch: "üé¨ –ü–æ–¥–±–æ—Ä–∫–∞ –Ω–∞ —Ä–µ–π—Å",
          sleep: "üåô –ú—è–≥–∫–æ —É—Å–Ω—É—Ç—å",
          fly: "üó∫Ô∏è –ú–∞—Ä—à—Ä—É—Ç –∏ –≥–¥–µ –º—ã",
          air: "‚úàÔ∏è –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ –æ —Å–∞–º–æ–ª—ë—Ç–µ",
          crew: "–°–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ä—Ç–ø—Ä–æ–≤–æ–¥–Ω–∏–∫—É"
        },

        watchAskDuration: "–ü–æ–¥–±–µ—Ä—É, —á—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å. –°–∫–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä–Ω–æ –ª–µ—Ç–µ—Ç—å?",
        dur: { short: "–î–æ 1 —á–∞—Å–∞", mid: "1‚Äì2 —á–∞—Å–∞", long: "2‚Äì4 —á–∞—Å–∞", xl: "–ë–æ–ª—å—à–µ 4 —á–∞—Å–æ–≤" },
        watchAskGenre: "–ö–∞–∫–æ–π –∂–∞–Ω—Ä —Ö–æ—á–µ—Ç—Å—è?",
        genre: { comedy: "–ö–æ–º–µ–¥–∏—è", detective: "–î–µ—Ç–µ–∫—Ç–∏–≤/—Ç—Ä–∏–ª–ª–µ—Ä", drama: "–î—Ä–∞–º–∞", scifi: "–§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞" },
        watchAskFormat: "–§–æ—Ä–º–∞—Ç: —Å–µ—Ä–∏–∞–ª –∏–ª–∏ —Ñ–∏–ª—å–º?",
        format: { series: "–°–µ—Ä–∏–∞–ª", film: "–§–∏–ª—å–º" },

        watchCardsTitle: (durLabel)=>`–ü–æ–¥–±–æ—Ä–∫–∞ (${durLabel})`,

        crewAsk: "–ß—Ç–æ –ø–µ—Ä–µ–¥–∞—Ç—å –±–æ—Ä—Ç–ø—Ä–æ–≤–æ–¥–Ω–∏–∫—É?",
        crew: {
          water: "–ü—Ä–∏–Ω–µ—Å–∏—Ç–µ –≤–æ–¥—É",
          pillow: "–ù—É–∂–Ω–∞ –ø–æ–¥—É—à–∫–∞",
          dinner: "–ó–∞–∫–∞–∂–∏—Ç–µ —É–∂–∏–Ω",
          kids: "–ü—Ä–∏–Ω–µ—Å–∏—Ç–µ –¥–µ—Ç—Å–∫–æ–µ –º–µ–Ω—é",
          more: "–ï—â—ë –∑–∞–ø—Ä–æ—Å",
          done: "–ì–æ—Ç–æ–≤–æ",
          accepted: (x)=>`–ü—Ä–∏–Ω—è—Ç–æ: ¬´${x}¬ª. –•–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —á—Ç–æ-—Ç–æ –µ—â—ë?`,
          ok: "–•–æ—Ä–æ—à–æ."
        },

        sleepAsk: "–•–æ—Ç–∏—Ç–µ 5 –º–∏–Ω—É—Ç –∏–ª–∏ 10 –º–∏–Ω—É—Ç?",
        sleep5: "5 –º–∏–Ω—É—Ç: –≤–¥–æ—Ö 4 ‚Äî –≤—ã–¥–æ—Ö 6. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ 8 —Ü–∏–∫–ª–æ–≤.",
        sleep10: "10 –º–∏–Ω—É—Ç: 2 –º–∏–Ω –¥—ã—Ö–∞–Ω–∏–µ + 3 –º–∏–Ω —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ + 5 –º–∏–Ω –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è.",

        flyAsk: "–•–æ—Ç–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤ –ø–æ –º–∞—Ä—à—Ä—É—Ç—É –∏–ª–∏ –≥–¥–µ –º—ã —Å–µ–π—á–∞—Å?",
        flyListBtn: "–ö–∞–∫–∏–µ –≥–æ—Ä–æ–¥–∞ –ø—Ä–æ–ª–µ—Ç–∞–µ–º",
        flyNowBtn: "–ß—Ç–æ –º—ã –ø—Ä–æ–ª–µ—Ç–∞–µ–º —Å–µ–π—á–∞—Å",
        flyWhereBtn: "–ê –≥–¥–µ –º—ã?",
        flyRouteBtn: "–ú–∞—Ä—à—Ä—É—Ç",

        airAsk: "–ü—Ä–æ —á—Ç–æ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å?",
        airSpeedBtn: "–ü—Ä–æ —Å–∫–æ—Ä–æ—Å—Ç—å",
        airTurbBtn: "–ü—Ä–æ —Ç—É—Ä–±—É–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å",
        airSpeed: "–ö—Ä–µ–π—Å–µ—Ä—Å–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—ã—á–Ω–æ 800‚Äì900 –∫–º/—á. –í–µ—Ç–µ—Ä –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å ‚Äú–ø–æ –∑–µ–º–ª–µ‚Äù.",
        airTurb: "–ï—Å–ª–∏ —Ç—Ä—è—Å—ë—Ç ‚Äî —Ä–µ–º–µ–Ω—å –ø—Ä–∏—Å—Ç—ë–≥–Ω—É—Ç. –≠–∫–∏–ø–∞–∂ –º–æ–∂–µ—Ç —Å–º–µ–Ω–∏—Ç—å —ç—à–µ–ª–æ–Ω –∏ –æ–±–æ–π—Ç–∏ –∑–æ–Ω—ã.",

        voiceOn: "–ì–æ–ª–æ—Å–æ–≤–æ–π —Ä–µ–∂–∏–º –≤–∫–ª—é—á—ë–Ω. –ì–æ–≤–æ—Ä–∏—Ç–µ ‚Äî —è –æ—Ç–≤–µ—á—É.",

        meta: {
          year: "–ì–æ–¥",
          runtime: "–í—Ä–µ–º—è",
          eps: "–≠–ø–∏–∑–æ–¥—ã",
          tags: "–¢–µ–≥–∏"
        }
      },

      en: {
        title: "AeroFriend",
        placeholder: "Ask me",
        emptyHint: "Tap ‚Äú+‚Äù for scenarios or ask a question ‚Äî I‚Äôll help during the flight.",
        quickCrew: "Crew message",
        voiceStart: "Talk",
        voiceStop: "Stop",
        drawerTitle: "Navigation",
        langTitle: "Language",

        navAerofriend: "AeroFriend",
        navAerofriendSub: "In-flight assistant chat",
        navEnt: "Entertainment",
        navEntSub: "Movies, music, games",
        navMap: "3D Map",
        navMapSub: "Route in 3D",

        sheetTitle: "What to do onboard",
        sheetSubtitle: "Pick a scenario ‚Äî I‚Äôll ask a couple of questions and suggest an option.",
        sheetWatchTitle: "üé¨ Picks for this flight",
        sheetWatchDesc: "Movie or series based on your taste and time.",
        sheetSleepTitle: "üåô Fall asleep gently",
        sheetSleepDesc: "Breathing and relaxation.",
        sheetFlyTitle: "üó∫Ô∏è Route & where we are",
        sheetFlyDesc: "Cities on the route and what‚Äôs below.",
        sheetAirTitle: "‚úàÔ∏è About the aircraft",
        sheetAirDesc: "Speed, altitude, turbulence.",

        errPick: "Sorry, I didn‚Äôt understand. Please choose from the list.",

        labels: { you: "You", bot: "AEROFriend" },

        hi: "Hi ‚Äî how can I help?",
        mainChips: {
          watch: "üé¨ Picks for flight",
          sleep: "üåô Fall asleep",
          fly: "üó∫Ô∏è Route & location",
          air: "‚úàÔ∏è About aircraft",
          crew: "Crew message"
        },

        watchAskDuration: "I‚Äôll suggest something to watch. How long is the flight?",
        dur: { short: "Up to 1 hour", mid: "1‚Äì2 hours", long: "2‚Äì4 hours", xl: "Over 4 hours" },
        watchAskGenre: "What genre do you feel like?",
        genre: { comedy: "Comedy", detective: "Mystery/Thriller", drama: "Drama", scifi: "Sci-fi" },
        watchAskFormat: "Format: series or movie?",
        format: { series: "Series", film: "Movie" },

        watchCardsTitle: (durLabel)=>`Picks (${durLabel})`,

        crewAsk: "What should I tell the crew?",
        crew: {
          water: "Please bring water",
          pillow: "I need a pillow",
          dinner: "Order dinner",
          kids: "Please bring kids‚Äô menu",
          more: "One more request",
          done: "Done",
          accepted: (x)=>`Got it: ‚Äú${x}‚Äù. Anything else?`,
          ok: "Okay."
        },

        sleepAsk: "Do you want 5 minutes or 10 minutes?",
        sleep5: "5 min: inhale 4 ‚Äî exhale 6. Repeat 8 cycles.",
        sleep10: "10 min: breathing + relaxation + short visualization.",

        flyAsk: "Do you want the route list or where we are now?",
        flyListBtn: "Cities on route",
        flyNowBtn: "Where are we now?",
        flyWhereBtn: "Where are we?",
        flyRouteBtn: "Route",

        airAsk: "What should I tell you about?",
        airSpeedBtn: "Speed",
        airTurbBtn: "Turbulence",
        airSpeed: "Typical cruise speed is about 800‚Äì900 km/h. Wind affects ground speed.",
        airTurb: "If it gets bumpy, keep your seat belt fastened. Crew may change altitude to avoid it.",

        voiceOn: "Voice mode is on. Speak ‚Äî I‚Äôll respond.",

        meta: {
          year: "Year",
          runtime: "Time",
          eps: "Episodes",
          tags: "Tags"
        }
      },

      tr: {
        title: "AeroDost",
        placeholder: "Sor bana",
        emptyHint: "Senaryolar i√ßin ‚Äú+‚Äùa dokunun veya soru sorun ‚Äî u√ßu≈ü boyunca yardƒ±mcƒ± olurum.",
        quickCrew: "Kabin ekibine mesaj",
        voiceStart: "Konu≈ü",
        voiceStop: "Durdur",
        drawerTitle: "Gezinme",
        langTitle: "Dil",

        navAerofriend: "AeroDost",
        navAerofriendSub: "U√ßu≈ü asistanƒ± sohbeti",
        navEnt: "Eƒülence",
        navEntSub: "Filmler, m√ºzik, oyunlar",
        navMap: "3D Harita",
        navMapSub: "3D rota",

        sheetTitle: "U√ßu≈üta ne yapmalƒ±",
        sheetSubtitle: "Bir senaryo se√ßin ‚Äî birka√ß soru sorup √∂neri sunacaƒüƒ±m.",
        sheetWatchTitle: "üé¨ Bu u√ßu≈ü i√ßin √∂neriler",
        sheetWatchDesc: "Zevkinize ve zamana g√∂re film/dizi.",
        sheetSleepTitle: "üåô Yumu≈üak√ßa uyku",
        sheetSleepDesc: "Nefes ve gev≈üeme.",
        sheetFlyTitle: "üó∫Ô∏è Rota ve konum",
        sheetFlyDesc: "Rota ≈üehirleri ve ≈üu an neresi.",
        sheetAirTitle: "‚úàÔ∏è U√ßak hakkƒ±nda",
        sheetAirDesc: "Hƒ±z, irtifa, t√ºrb√ºlans.",

        errPick: "√úzg√ºn√ºm, anlayamadƒ±m. L√ºtfen listeden se√ßin.",

        labels: { you: "Sen", bot: "AERODost" },

        hi: "Merhaba ‚Äî nasƒ±l yardƒ±mcƒ± olayƒ±m?",
        mainChips: {
          watch: "üé¨ √ñneriler",
          sleep: "üåô Uyu",
          fly: "üó∫Ô∏è Rota & konum",
          air: "‚úàÔ∏è U√ßak",
          crew: "Ekip mesajƒ±"
        },

        watchAskDuration: "Ne izlemek istersiniz? U√ßu≈ü ne kadar s√ºr√ºyor?",
        dur: { short: "1 saate kadar", mid: "1‚Äì2 saat", long: "2‚Äì4 saat", xl: "4 saatten fazla" },
        watchAskGenre: "Hangi t√ºr olsun?",
        genre: { comedy: "Komedi", detective: "Gizem/Thriller", drama: "Dram", scifi: "Bilim kurgu" },
        watchAskFormat: "Dizi mi film mi?",
        format: { series: "Dizi", film: "Film" },

        watchCardsTitle: (durLabel)=>`√ñneriler (${durLabel})`,

        crewAsk: "Kabin ekibine ne ileteyim?",
        crew: {
          water: "Su getirir misiniz",
          pillow: "Yastƒ±k lazƒ±m",
          dinner: "Ak≈üam yemeƒüi",
          kids: "√áocuk men√ºs√º",
          more: "Bir istek daha",
          done: "Bitti",
          accepted: (x)=>`Alƒ±ndƒ±: ‚Äú${x}‚Äù. Ba≈üka bir ≈üey var mƒ±?`,
          ok: "Tamam."
        },

        sleepAsk: "5 dakika mƒ± 10 dakika mƒ±?",
        sleep5: "5 dk: 4 sayƒ±da nefes al ‚Äî 6 sayƒ±da ver. 8 tur.",
        sleep10: "10 dk: nefes + gev≈üeme + kƒ±sa g√∂rselle≈ütirme.",

        flyAsk: "Rota listesi mi yoksa ≈üu an nerede olduƒüumuz mu?",
        flyListBtn: "Rota ≈üehirleri",
        flyNowBtn: "≈ûu an neredeyiz?",
        flyWhereBtn: "Neredeyiz?",
        flyRouteBtn: "Rota",

        airAsk: "Ne anlatayƒ±m?",
        airSpeedBtn: "Hƒ±z",
        airTurbBtn: "T√ºrb√ºlans",
        airSpeed: "Seyir hƒ±zƒ± genelde 800‚Äì900 km/s. R√ºzg√¢r yer hƒ±zƒ±nƒ± etkiler.",
        airTurb: "Sarsƒ±ntƒ±da kemeri takƒ±lƒ± tutun. Ekip irtifa deƒüi≈ütirerek ka√ßƒ±nabilir.",

        voiceOn: "Ses modu a√ßƒ±k. Konu≈üun ‚Äî yanƒ±tlayacaƒüƒ±m.",

        meta: {
          year: "Yƒ±l",
          runtime: "S√ºre",
          eps: "B√∂l√ºmler",
          tags: "Etiketler"
        }
      }
    };

    function t(){ return I18N[LANG]; }

    // =========================
    // DOM
    // =========================
    const messagesEl = document.getElementById('messages');
    const emptyHintEl = document.getElementById('emptyHint');
    const inputEl = document.getElementById('input');
    const sendEl = document.getElementById('send');

    const burgerEl = document.getElementById('burger');
    const drawerOverlayEl = document.getElementById('drawerOverlay');
    const drawerCloseEl = document.getElementById('drawerClose');

    const plusEl = document.getElementById('plus');
    const overlayEl = document.getElementById('overlay');
    const closeSheetEl = document.getElementById('closeSheet');

    const crewBtnFixedEl = document.getElementById('crewBtnFixed');
    const voiceBtnEl = document.getElementById('voiceBtn');

    const ui = {
      titleH1: document.getElementById('titleH1'),
      sheetTitle: document.getElementById('sheetTitle'),
      sheetSubtitle: document.getElementById('sheetSubtitle'),
      sheetWatchTitle: document.getElementById('sheetWatchTitle'),
      sheetWatchDesc: document.getElementById('sheetWatchDesc'),
      sheetSleepTitle: document.getElementById('sheetSleepTitle'),
      sheetSleepDesc: document.getElementById('sheetSleepDesc'),
      sheetFlyTitle: document.getElementById('sheetFlyTitle'),
      sheetFlyDesc: document.getElementById('sheetFlyDesc'),
      sheetAirTitle: document.getElementById('sheetAirTitle'),
      sheetAirDesc: document.getElementById('sheetAirDesc'),
      drawerTitle: document.getElementById('drawerTitle'),
      langTitle: document.getElementById('langTitle'),
      navAerofriend: document.getElementById('navAerofriend'),
      navAerofriendSub: document.getElementById('navAerofriendSub'),
      navEnt: document.getElementById('navEnt'),
      navEntSub: document.getElementById('navEntSub'),
      navMap: document.getElementById('navMap'),
      navMapSub: document.getElementById('navMapSub'),
    };

    function normalize(s){ return (s||'').toLowerCase().replace(/—ë/g,'–µ').trim(); }
    function hideEmptyHint(){ if (emptyHintEl) emptyHintEl.style.display = 'none'; }

    function addMessage({from, text, node, chips}){
      hideEmptyHint();

      const msg = document.createElement('div');
      msg.className = `msg ${from}`;

      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = (from === 'bot') ? t().labels.bot : t().labels.you;

      const bubble = document.createElement('div');
      bubble.className = 'bubble';

      if (node){
        bubble.appendChild(node);
      } else {
        bubble.textContent = text;
      }

      msg.appendChild(label);
      msg.appendChild(bubble);

      if (Array.isArray(chips) && chips.length){
        const chipsWrap = document.createElement('div');
        chipsWrap.className = 'chips';

        for (const c of chips){
          const b = document.createElement('button');
          b.className = 'chip';
          b.type = 'button';
          b.textContent = c.label;
          b.addEventListener('click', () => onUserUtterance(c.label, { internalValue: c.value, alreadyRenderedUser: false }));
          chipsWrap.appendChild(b);
        }
        msg.appendChild(chipsWrap);
      }

      messagesEl.appendChild(msg);
      requestAnimationFrame(() => { messagesEl.scrollTop = messagesEl.scrollHeight; });
    }

    function aeroSay(text, chips){ addMessage({from:'bot', text, chips}); }
    function aeroNode(node, chips){ addMessage({from:'bot', node, chips}); }
    function userSay(text){ addMessage({from:'user', text}); }

    // =========================
    // Dynamic chips per language
    // =========================
    function chipsMainMenu(){
      const x = t().mainChips;
      return [
        {label: x.watch, value:'start:watch'},
        {label: x.sleep, value:'start:sleep'},
        {label: x.fly, value:'start:flyover'},
        {label: x.air, value:'start:aircraft'},
        {label: x.crew, value:'start:crew'}
      ];
    }
    function chipsDuration(){
      const d = t().dur;
      return [
        {label: d.short, value:'dur:short'},
        {label: d.mid, value:'dur:mid'},
        {label: d.long, value:'dur:long'},
        {label: d.xl, value:'dur:xl'}
      ];
    }
    function chipsGenre(){
      const g = t().genre;
      return [
        {label: g.comedy, value:'genre:comedy'},
        {label: g.detective, value:'genre:detective'},
        {label: g.drama, value:'genre:drama'},
        {label: g.scifi, value:'genre:scifi'}
      ];
    }
    function chipsFormat(){
      const f = t().format;
      return [
        {label: f.series, value:'format:series'},
        {label: f.film, value:'format:film'}
      ];
    }
    function chipsCrew(){
      const c = t().crew;
      return [
        {label: c.water, value:'crew:water'},
        {label: c.pillow, value:'crew:pillow'},
        {label: c.dinner, value:'crew:dinner'},
        {label: c.kids, value:'crew:kids'}
      ];
    }
    function chipsCrewAfter(){
      const c = t().crew;
      return [
        {label: c.more, value:'crew:more'},
        {label: c.done, value:'crew:done'}
      ];
    }

    function errorPickFromList(chips){
      aeroSay(t().errPick, chips || chipsMainMenu());
    }

    // =========================
    // Movie catalog (posters from Wikimedia)
    // =========================
    const MOVIES = {
      // FILMS
      grandBudapest: {
        type:"film",
        title:{ru:"–û—Ç–µ–ª—å ¬´–ì—Ä–∞–Ω–¥ –ë—É–¥–∞–ø–µ—à—Ç¬ª", en:"The Grand Budapest Hotel", tr:"The Grand Budapest Hotel"},
        year:2014, runtime:"1—á 39–º",
        desc:{
          ru:"–ò—Ä–æ–Ω–∏—á–Ω–∞—è –∞–≤–∞–Ω—Ç—é—Ä–∞ –ø—Ä–æ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω–æ–≥–æ –∫–æ–Ω—Å—å–µ—Ä–∂–∞ –∏ –∏—Å—Ç–æ—Ä–∏—é –æ–¥–Ω–æ–≥–æ –æ—Ç–µ–ª—è.",
          en:"A witty caper around a legendary concierge and a famous hotel.",
          tr:"Efsane bir konsiyerj ve √ºnl√º bir otel etrafƒ±nda esprili bir macera."
        },
        tags:["comedy","adventure"],
        poster:"https://upload.wikimedia.org/wikipedia/en/a/a6/The_Grand_Budapest_Hotel_Poster.jpg"
      },
      palmSprings: {
        type:"film",
        title:{ru:"–ü–∞–ª–º-–°–ø—Ä–∏–Ω–≥—Å", en:"Palm Springs", tr:"Palm Springs"},
        year:2020, runtime:"1—á 30–º",
        desc:{
          ru:"–õ—ë–≥–∫–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–º–µ–¥–∏—è –ø—Ä–æ –¥–µ–Ω—å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è.",
          en:"A light sci-fi comedy about a day that keeps repeating.",
          tr:"S√ºrekli tekrar eden bir g√ºn hakkƒ±nda hafif bir bilim kurgu komedisi."
        },
        tags:["comedy","scifi"],
        poster:"https://upload.wikimedia.org/wikipedia/en/2/25/Palm_Springs_%282020_film%29.png"
      },
      paddington: {
        type:"film",
        title:{ru:"–ü–∞–¥–¥–∏–Ω–≥—Ç–æ–Ω", en:"Paddington", tr:"Paddington"},
        year:2014, runtime:"1—á 36–º",
        desc:{
          ru:"–î–æ–±—Ä–∞—è —Å–µ–º–µ–π–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è, –æ—Ç–ª–∏—á–Ω–æ —Ä–∞–∑–≥—Ä—É–∂–∞–µ—Ç –≥–æ–ª–æ–≤—É –≤ –ø–æ–ª—ë—Ç–µ.",
          en:"Warm family story ‚Äî perfect for an easy flight watch.",
          tr:"Sƒ±cak bir aile hik√¢yesi ‚Äî u√ßu≈ü i√ßin ideal."
        },
        tags:["comedy","family"],
        poster:"https://upload.wikimedia.org/wikipedia/en/7/7e/Paddington_poster.jpg"
      },

      knivesOut: {
        type:"film",
        title:{ru:"–î–æ—Å—Ç–∞—Ç—å –Ω–æ–∂–∏", en:"Knives Out", tr:"Knives Out"},
        year:2019, runtime:"2—á 10–º",
        desc:{
          ru:"–°—Ç–∏–ª—å–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–∏–≤ —Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º–∏ –ø–æ–≤–æ—Ä–æ—Ç–∞–º–∏ –∏ –æ—Ç–ª–∏—á–Ω—ã–º —Ç–µ–º–ø–æ–º.",
          en:"A stylish mystery with sharp twists and great pacing.",
          tr:"Keskin ters k√∂≈üelerle ≈üƒ±k bir gizem."
        },
        tags:["detective","thriller"],
        poster:"https://upload.wikimedia.org/wikipedia/en/1/1f/Knives_Out_poster.jpeg"
      },
      sherlockHolmes2009: {
        type:"film",
        title:{ru:"–®–µ—Ä–ª–æ–∫ –•–æ–ª–º—Å", en:"Sherlock Holmes", tr:"Sherlock Holmes"},
        year:2009, runtime:"2—á 08–º",
        desc:{
          ru:"–≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–∏–≤-–±–æ–µ–≤–∏–∫: —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏ —Ö–∞—Ä–∏–∑–º–∞ –¥—É—ç—Ç–∞.",
          en:"High-energy detective action with a charismatic duo.",
          tr:"Karizmatik ikiliyle tempolu dedektif aksiyonu."
        },
        tags:["detective","action"],
        poster:"https://upload.wikimedia.org/wikipedia/en/6/6e/Sherlock_holmes_ver5.jpg"
      },
      goneGirl: {
        type:"film",
        title:{ru:"–ò—Å—á–µ–∑–Ω—É–≤—à–∞—è", en:"Gone Girl", tr:"Gone Girl"},
        year:2014, runtime:"2—á 29–º",
        desc:{
          ru:"–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç—Ä–∏–ª–ª–µ—Ä: –∏–Ω—Ç—Ä–∏–≥–∞, –º–µ–¥–∏–∞ –∏ –¥–≤–æ–π–Ω—ã–µ —Å–º—ã—Å–ª—ã.",
          en:"A psychological thriller about media, intrigue, and masks.",
          tr:"Medya ve entrika √ºzerine psikolojik thriller."
        },
        tags:["thriller","drama"],
        poster:"https://upload.wikimedia.org/wikipedia/en/0/05/Gone_Girl_Poster.jpg"
      },

      whiplash: {
        type:"film",
        title:{ru:"–û–¥–µ—Ä–∂–∏–º–æ—Å—Ç—å", en:"Whiplash", tr:"Whiplash"},
        year:2014, runtime:"1—á 47–º",
        desc:{
          ru:"–î—Ä–∞–º–∞ –ø—Ä–æ –∞–º–±–∏—Ü–∏–∏ –∏ —Ü–µ–Ω—É –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–∞. –û—á–µ–Ω—å –±–æ–¥—Ä–∏—Ç.",
          en:"A drama about ambition and the cost of mastery.",
          tr:"Hƒ±rs ve ustalƒ±ƒüƒ±n bedeli √ºzerine bir dram."
        },
        tags:["drama","music"],
        poster:"https://upload.wikimedia.org/wikipedia/en/0/01/Whiplash_poster.jpg"
      },
      trumanShow: {
        type:"film",
        title:{ru:"–®–æ—É –¢—Ä—É–º–∞–Ω–∞", en:"The Truman Show", tr:"The Truman Show"},
        year:1998, runtime:"1—á 43–º",
        desc:{
          ru:"–£–º–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ –º–∏—Ä–µ ‚Äú–∫–∞–∫ –±—É–¥—Ç–æ‚Äù, –≥–¥–µ –≤—Å—ë –Ω–µ —Ç–æ, —á–µ–º –∫–∞–∂–µ—Ç—Å—è.",
          en:"A smart story about a world where nothing is what it seems.",
          tr:"Hi√ßbir ≈üeyin g√∂r√ºnd√ºƒü√º gibi olmadƒ±ƒüƒ± akƒ±llƒ± bir hik√¢ye."
        },
        tags:["drama","comedy"],
        poster:"https://upload.wikimedia.org/wikipedia/en/c/cd/The_Truman_Show_poster.jpg"
      },
      littleMissSunshine: {
        type:"film",
        title:{ru:"–ú–∞–ª–µ–Ω—å–∫–∞—è –º–∏—Å—Å –°—á–∞—Å—Ç—å–µ", en:"Little Miss Sunshine", tr:"Little Miss Sunshine"},
        year:2006, runtime:"1—á 41–º",
        desc:{
          ru:"–¢–µ–ø–ª–∞—è –¥—Ä–∞–º–µ–¥–∏ –æ —Å–µ–º—å–µ –∏ –¥–æ—Ä–æ–≥–µ ‚Äî –º—è–≥–∫–æ –∏ —á–µ–ª–æ–≤–µ—á–Ω–æ.",
          en:"A warm road dramedy about family and being human.",
          tr:"Aile ve yol √ºzerine sƒ±cak bir dram-komedi."
        },
        tags:["drama","comedy"],
        poster:"https://upload.wikimedia.org/wikipedia/en/3/3f/Little_Miss_Sunshine_poster.png"
      },

      sourceCode: {
        type:"film",
        title:{ru:"–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥", en:"Source Code", tr:"Source Code"},
        year:2011, runtime:"1—á 33–º",
        desc:{
          ru:"–§–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–∏–ª–ª–µ—Ä —Å –¥–∏–Ω–∞–º–∏–∫–æ–π –∏ —è—Å–Ω–æ–π —Ä–∞–∑–≤—è–∑–∫–æ–π.",
          en:"A tight sci-fi thriller with a clear, punchy payoff.",
          tr:"Net finali olan tempolu bilim kurgu thriller."
        },
        tags:["scifi","thriller"],
        poster:"https://upload.wikimedia.org/wikipedia/en/8/85/Source_Code_Poster.jpg"
      },
      edgeOfTomorrow: {
        type:"film",
        title:{ru:"–ì—Ä–∞–Ω—å –±—É–¥—É—â–µ–≥–æ", en:"Edge of Tomorrow", tr:"Edge of Tomorrow"},
        year:2014, runtime:"1—á 53–º",
        desc:{
          ru:"–≠–∫—à–µ–Ω –∏ —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞: –ø–æ–≤—Ç–æ—Ä –¥–Ω—è, –ø—Ä–æ–∫–∞—á–∫–∞ –Ω–∞–≤—ã–∫–æ–≤ –∏ –±–æ–π.",
          en:"Sci-fi action: looping day, leveling up, and big battles.",
          tr:"Tekrarlanan g√ºn, geli≈üim ve aksiyon dolu bilim kurgu."
        },
        tags:["scifi","action"],
        poster:"https://upload.wikimedia.org/wikipedia/en/f/f9/Edge_of_Tomorrow_Poster.jpg"
      },
      her: {
        type:"film",
        title:{ru:"–û–Ω–∞", en:"Her", tr:"Her"},
        year:2013, runtime:"2—á 06–º",
        desc:{
          ru:"–°–ø–æ–∫–æ–π–Ω–∞—è —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞ –æ –±–ª–∏–∑–æ—Å—Ç–∏ –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö ‚Äî –æ—á–µ–Ω—å –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ.",
          en:"A calm, atmospheric sci-fi about intimacy and technology.",
          tr:"Yakƒ±nlƒ±k ve teknoloji √ºzerine sakin, atmosferik bilim kurgu."
        },
        tags:["scifi","drama"],
        poster:"https://upload.wikimedia.org/wikipedia/en/4/44/Her_poster.jpg"
      },

      // SERIES
      theOffice: {
        type:"series",
        title:{ru:"–û—Ñ–∏—Å", en:"The Office", tr:"The Office"},
        year:2005, eps:"2‚Äì3",
        desc:{
          ru:"–°—É—Ö–æ–π —é–º–æ—Ä –∏ –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–µ—Ä–∏–∏ ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ –Ω–∞ –±–æ—Ä—Ç—É.",
          en:"Dry humor + short episodes ‚Äî perfect on a flight.",
          tr:"Kuru mizah ve kƒ±sa b√∂l√ºmler ‚Äî u√ßu≈ü i√ßin ideal."
        },
        tags:["comedy"],
        poster:"https://avatars.mds.yandex.net/get-kinopoisk-image/1773646/18786d1d-e37f-4b05-8757-144660a44846/180"
      },
      modernFamily: {
        type:"series",
        title:{ru:"–ê–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∞—è —Å–µ–º–µ–π–∫–∞", en:"Modern Family", tr:"Modern Family"},
        year:2009, eps:"3‚Äì4",
        desc:{
          ru:"–õ—ë–≥–∫–∞—è —Å–µ–º–µ–π–Ω–∞—è –∫–æ–º–µ–¥–∏—è. –°–º–æ—Ç—Ä–∏—Ç—Å—è –±–µ–∑ —É—Å–∏–ª–∏–π.",
          en:"Easy family comedy ‚Äî effortless watching.",
          tr:"Kolay aile komedisi ‚Äî rahat izlenir."
        },
        tags:["comedy","family"],
        poster:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRPb7fjf6BMzow98Z5CqglprtwZREH6epKf-A&s"
      },
      b99: {
        type:"series",
        title:{ru:"–ë—Ä—É–∫–ª–∏–Ω 9-9", en:"Brooklyn Nine-Nine", tr:"Brooklyn Nine-Nine"},
        year:2013, eps:"3‚Äì4",
        desc:{
          ru:"–ë—ã—Å—Ç—Ä—ã–π —é–º–æ—Ä, —Ö–∞—Ä–∏–∑–º–∞—Ç–∏—á–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –∏ –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–µ—Ä–∏–∏.",
          en:"Fast jokes, great cast, short episodes.",
          tr:"Hƒ±zlƒ± ≈üakalar, iyi ekip, kƒ±sa b√∂l√ºmler."
        },
        tags:["comedy"],
        poster:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRa3wsVN1N3hnZTLmHcIkRvqijskhipaVBXnw&sg"
      },

      sherlockSeries: {
        type:"series",
        title:{ru:"–®–µ—Ä–ª–æ–∫", en:"Sherlock", tr:"Sherlock"},
        year:2010, eps:"1",
        desc:{
          ru:"–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è: –æ–¥–Ω–∞ —Å–µ—Ä–∏—è ‚Äî –∫–∞–∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ñ–∏–ª—å–º.",
          en:"Modern adaptation ‚Äî one episode feels like a full movie.",
          tr:"Modern uyarlama ‚Äî bir b√∂l√ºm tam film gibi."
        },
        tags:["detective","thriller"],
        poster:"https://upload.wikimedia.org/wikipedia/en/b/b9/Sherlock_titlecard.jpg"
      },
      onlyMurders: {
        type:"series",
        title:{ru:"–£–±–∏–π—Å—Ç–≤–∞ –≤ –æ–¥–Ω–æ–º –∑–¥–∞–Ω–∏–∏", en:"Only Murders in the Building", tr:"Only Murders in the Building"},
        year:2021, eps:"2‚Äì3",
        desc:{
          ru:"–î–µ—Ç–µ–∫—Ç–∏–≤ —Å –ª—ë–≥–∫–∏–º —é–º–æ—Ä–æ–º –∏ –æ—á–µ–Ω—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–º —Ä–∏—Ç–º–æ–º.",
          en:"A cozy mystery with light humor and great pacing.",
          tr:"Hafif mizahlƒ±, keyifli bir gizem."
        },
        tags:["detective","comedy"],
        poster:"https://upload.wikimedia.org/wikipedia/en/2/26/Only_Murders_in_the_Building.jpeg"
      },
      broadchurch: {
        type:"series",
        title:{ru:"–ë—Ä–æ–¥—á–µ—Ä—á", en:"Broadchurch", tr:"Broadchurch"},
        year:2013, eps:"2",
        desc:{
          ru:"–ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–π –¥–µ—Ç–µ–∫—Ç–∏–≤: –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –∏ –æ—Ç–ª–∏—á–Ω—ã–π –∞–∫—Ç—ë—Ä—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤.",
          en:"Atmospheric mystery with strong tension and cast.",
          tr:"Gergin ve atmosferik bir polisiye."
        },
        tags:["detective","drama"],
        poster:"https://upload.wikimedia.org/wikipedia/en/7/7c/Broadchurch_Series_1.jpeg"
      },

      theBear: {
        type:"series",
        title:{ru:"–ú–µ–¥–≤–µ–¥—å", en:"The Bear", tr:"The Bear"},
        year:2022, eps:"2‚Äì3",
        desc:{
          ru:"–ë—ã—Å—Ç—Ä—ã–π —Ç–µ–º–ø, —ç–º–æ—Ü–∏–∏ –∏ –∫—É—Ö–Ω—è ‚Äî –æ—á–µ–Ω—å —Ü–µ–ø–ª—è–µ—Ç.",
          en:"Fast-paced, emotional, kitchen chaos ‚Äî very engaging.",
          tr:"Hƒ±zlƒ± tempo, duygular ve mutfak kaosu ‚Äî s√ºr√ºkleyici."
        },
        tags:["drama"],
        poster:"https://upload.wikimedia.org/wikipedia/en/3/37/The_Bear_TV_series.jpg"
      },
      fleabag: {
        type:"series",
        title:{ru:"–î—Ä—è–Ω—å", en:"Fleabag", tr:"Fleabag"},
        year:2016, eps:"3‚Äì4",
        desc:{
          ru:"–ö–æ—Ä–æ—Ç–∫–æ, –æ—Å—Ç—Ä–æ—É–º–Ω–æ –∏ —á–µ—Å—Ç–Ω–æ. –°–µ—Ä–∏–∏ –∏–¥—É—Ç –Ω–∞ –æ–¥–Ω–æ–º –¥—ã—Ö–∞–Ω–∏–∏.",
          en:"Short, sharp, honest ‚Äî episodes fly by.",
          tr:"Kƒ±sa, zeki ve d√ºr√ºst ‚Äî b√∂l√ºmler akƒ±p gider."
        },
        tags:["drama","comedy"],
        poster:"https://upload.wikimedia.org/wikipedia/en/5/5d/Fleabag_series_1.jpg"
      },
      queensGambit: {
        type:"series",
        title:{ru:"–•–æ–¥ –∫–æ—Ä–æ–ª–µ–≤—ã", en:"The Queen's Gambit", tr:"The Queen's Gambit"},
        year:2020, eps:"1",
        desc:{
          ru:"–û—á–µ–Ω—å —Å—Ç–∏–ª—å–Ω–∞—è –¥—Ä–∞–º–∞: —à–∞—Ö–º–∞—Ç—ã, –≤–∑—Ä–æ—Å–ª–µ–Ω–∏–µ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä.",
          en:"Stylish drama: chess, growth, and character.",
          tr:"≈ûƒ±k bir dram: satran√ß, geli≈üim ve karakter."
        },
        tags:["drama"],
        poster:"https://upload.wikimedia.org/wikipedia/en/2/2d/The_Queen%27s_Gambit_poster.jpg"
      },

      blackMirror: {
        type:"series",
        title:{ru:"–ß—ë—Ä–Ω–æ–µ –∑–µ—Ä–∫–∞–ª–æ", en:"Black Mirror", tr:"Black Mirror"},
        year:2011, eps:"1",
        desc:{
          ru:"–ê–Ω—Ç–æ–ª–æ–≥–∏—è: –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –æ–¥–Ω—É —Å–∏–ª—å–Ω—É—é —Å–µ—Ä–∏—é –ø–æ–¥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ.",
          en:"Anthology ‚Äî pick one powerful episode to match your mood.",
          tr:"Antoloji ‚Äî ruh h√¢line g√∂re tek b√∂l√ºm se√ßebilirsin."
        },
        tags:["scifi","thriller"],
        poster:"https://upload.wikimedia.org/wikipedia/en/2/2f/Black_Mirror_intertitle.png"
      },
      ldr: {
        type:"series",
        title:{ru:"–õ—é–±–æ–≤—å, —Å–º–µ—Ä—Ç—å –∏ —Ä–æ–±–æ—Ç—ã", en:"Love, Death & Robots", tr:"Love, Death & Robots"},
        year:2019, eps:"3‚Äì5",
        desc:{
          ru:"–ö–æ—Ä–æ—Ç–∫–∏–µ –∞–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏—Å—Ç–æ—Ä–∏–∏ ‚Äî —É–¥–æ–±–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—Ä–µ–∑–∫–∞–º–∏.",
          en:"Short animated stories ‚Äî great in small chunks.",
          tr:"Kƒ±sa animasyon hik√¢yeleri ‚Äî par√ßa par√ßa izlemek i√ßin iyi."
        },
        tags:["scifi","animation"],
        poster:"https://upload.wikimedia.org/wikipedia/en/8/8b/Love%2C_Death_%26_Robots.png"
      },
      strangerThings: {
        type:"series",
        title:{ru:"–û—á–µ–Ω—å —Å—Ç—Ä–∞–Ω–Ω—ã–µ –¥–µ–ª–∞", en:"Stranger Things", tr:"Stranger Things"},
        year:2016, eps:"1‚Äì2",
        desc:{
          ru:"–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –∏ —Ñ–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞: –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞ 80-—Ö –∏ –æ—Ç–ª–∏—á–Ω—ã–π —Å—é–∂–µ—Ç.",
          en:"Adventure sci-fi with an 80s vibe and strong story.",
          tr:"80'ler havasƒ±nda macera ve bilim kurgu."
        },
        tags:["scifi","adventure"],
        poster:"https://upload.wikimedia.org/wikipedia/en/f/f7/Stranger_Things_season_1.jpg"
      }
    };

    // –ø–æ–¥–±–æ—Ä–∫–∏ –ø–æ –∂–∞–Ω—Ä—É/—Ñ–æ—Ä–º–∞—Ç—É
    const WATCH_PICK_KEYS = {
      comedy: {
        film: ["grandBudapest","palmSprings","paddington"],
        series: ["theOffice","modernFamily","b99"]
      },
      detective: {
        film: ["knivesOut","sherlockHolmes2009","goneGirl"],
        series: ["sherlockSeries","onlyMurders","broadchurch"]
      },
      drama: {
        film: ["whiplash","trumanShow","littleMissSunshine"],
        series: ["theBear","fleabag","queensGambit"]
      },
      scifi: {
        film: ["sourceCode","edgeOfTomorrow","her"],
        series: ["blackMirror","ldr","strangerThings"]
      }
    };

    function durationLabel(durKey){
      const d = t().dur;
      const map = { short:d.short, mid:d.mid, long:d.long, xl:d.xl };
      return map[durKey] || '';
    }

    function getMovieTitle(m){
      return m.title[LANG] || m.title.en || m.title.ru || "";
    }

    function renderWatchCards(genreKey, formatKey, durKey){
      const keys = (WATCH_PICK_KEYS[genreKey] && WATCH_PICK_KEYS[genreKey][formatKey]) ? WATCH_PICK_KEYS[genreKey][formatKey] : [];
      const items = keys.map(k => MOVIES[k]).filter(Boolean);

      const wrap = document.createElement("div");

      const h = document.createElement("div");
      h.className = "movieBlockTitle";
      h.textContent = t().watchCardsTitle(durationLabel(durKey));
      wrap.appendChild(h);

      const list = document.createElement("div");
      list.className = "movieCards";

      for (const m of items){
        const card = document.createElement("div");
        card.className = "movieCard";

        const poster = document.createElement("div");
        poster.className = "moviePoster";
        const img = document.createElement("img");
        img.src = m.poster;
        img.alt = getMovieTitle(m);
        img.loading = "lazy";
        poster.appendChild(img);

        const meta = document.createElement("div");
        meta.className = "movieMeta";

        const name = document.createElement("div");
        name.className = "movieName";
        name.textContent = getMovieTitle(m);

        const line = document.createElement("div");
        line.className = "movieLine";
        if (m.type === "film"){
          line.textContent = `${t().meta.year}: ${m.year} ¬∑ ${t().meta.runtime}: ${m.runtime}`;
        } else {
          line.textContent = `${t().meta.year}: ${m.year} ¬∑ ${t().meta.eps}: ${m.eps}`;
        }

        const desc = document.createElement("div");
        desc.className = "movieDesc";
        desc.textContent = (m.desc[LANG] || m.desc.en || m.desc.ru || "");

        const tags = document.createElement("div");
        tags.className = "tagRow";
        for (const tg of (m.tags || []).slice(0,3)){
          const span = document.createElement("span");
          span.className = "tag";
          span.textContent = tg;
          tags.appendChild(span);
        }

        meta.appendChild(name);
        meta.appendChild(line);
        meta.appendChild(desc);
        meta.appendChild(tags);

        card.appendChild(poster);
        card.appendChild(meta);
        list.appendChild(card);
      }

      wrap.appendChild(list);
      return wrap;
    }

    // =========================
    // Route Moscow -> Kazan
    // =========================
    const route = [
      { overRU:"–ú–æ—Å–∫–≤–æ–π", overEN:"Moscow", overTR:"Moskova", infoRU:"–ú–æ—Å–∫–≤–∞ ‚Äî –∫—Ä—É–ø–Ω–µ–π—à–∏–π –≥–æ—Ä–æ–¥ –†–æ—Å—Å–∏–∏, –∫—É–ª—å—Ç—É—Ä–Ω—ã–π –∏ –¥–µ–ª–æ–≤–æ–π —Ü–µ–Ω—Ç—Ä.", infoEN:"Moscow is Russia‚Äôs largest city and a major cultural and business hub.", infoTR:"Moskova Rusya‚Äônƒ±n en b√ºy√ºk ≈üehri; k√ºlt√ºr ve i≈ü merkezi." },
      { overRU:"–í–ª–∞–¥–∏–º–∏—Ä–æ–º", overEN:"Vladimir", overTR:"Vladimir", infoRU:"–í–ª–∞–¥–∏–º–∏—Ä ‚Äî –≥–æ—Ä–æ–¥ –ó–æ–ª–æ—Ç–æ–≥–æ –∫–æ–ª—å—Ü–∞, –∏–∑–≤–µ—Å—Ç–µ–Ω –±–µ–ª–æ–∫–∞–º–µ–Ω–Ω—ã–º–∏ —Å–æ–±–æ—Ä–∞–º–∏.", infoEN:"Vladimir is a historic city known for its white-stone cathedrals.", infoTR:"Vladimir tarihi bir ≈üehir; beyaz ta≈ü katedralleriyle bilinir." },
      { overRU:"–ù–∏–∂–Ω–∏–º –ù–æ–≤–≥–æ—Ä–æ–¥–æ–º", overEN:"Nizhny Novgorod", overTR:"Nijni Novgorod", infoRU:"–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥ ‚Äî –Ω–∞ —Å–ª–∏—è–Ω–∏–∏ –í–æ–ª–≥–∏ –∏ –û–∫–∏, –∑–Ω–∞–º–µ–Ω–∏—Ç –∫—Ä–µ–º–ª—ë–º –∏ –Ω–∞–±–µ—Ä–µ–∂–Ω—ã–º–∏.", infoEN:"Nizhny Novgorod lies at the Volga‚ÄìOka confluence and is famous for its Kremlin.", infoTR:"Nijni Novgorod Volga‚ÄìOka birle≈üiminde; Kremlin‚Äôiyle √ºnl√ºd√ºr." },
      { overRU:"–ß–µ–±–æ–∫—Å–∞—Ä–∞–º–∏", overEN:"Cheboksary", overTR:"√áeboksarƒ±", infoRU:"–ß–µ–±–æ–∫—Å–∞—Ä—ã ‚Äî —Å—Ç–æ–ª–∏—Ü–∞ –ß—É–≤–∞—à–∏–∏ –Ω–∞ –í–æ–ª–≥–µ, –∏–∑–≤–µ—Å—Ç–Ω–∞ –∑–∞–ª–∏–≤–æ–º –∏ –Ω–∞–±–µ—Ä–µ–∂–Ω–æ–π.", infoEN:"Cheboksary is the capital of Chuvashia on the Volga River.", infoTR:"√áeboksarƒ± Volga kƒ±yƒ±sƒ±nda; √áuva≈üya‚Äônƒ±n ba≈ükentidir." },
      { overRU:"–ö–∞–∑–∞–Ω—å—é", overEN:"Kazan", overTR:"Kazan", infoRU:"–ö–∞–∑–∞–Ω—å ‚Äî —Å—Ç–æ–ª–∏—Ü–∞ –¢–∞—Ç–∞—Ä—Å—Ç–∞–Ω–∞; –ö—Ä–µ–º–ª—å –∏ –ö—É–ª-–®–∞—Ä–∏—Ñ ‚Äî —Å–∏–º–≤–æ–ª—ã –≥–æ—Ä–æ–¥–∞.", infoEN:"Kazan is the capital of Tatarstan, known for its Kremlin and Kul Sharif mosque.", infoTR:"Kazan Tataristan‚Äôƒ±n ba≈ükenti; Kremlin ve Kul ≈ûerif Camii ile √ºnl√ºd√ºr." }
    ];
    let routeIdx = 0;

    function flyNowText(){
      const p = route[Math.min(routeIdx, route.length-1)];
      if (routeIdx < route.length-1) routeIdx++;

      if (LANG === "ru") return `–ú—ã –Ω–∞–¥ ${p.overRU}.\n${p.infoRU}`;
      if (LANG === "tr") return `≈ûu an ${p.overTR} √ºzerindeyiz.\n${p.infoTR}`;
      return `We are over ${p.overEN}.\n${p.infoEN}`;
    }

    function flyListText(){
      if (LANG === "ru") return "–ú–∞—Ä—à—Ä—É—Ç:\n‚Ä¢ –ú–æ—Å–∫–≤–∞\n‚Ä¢ –í–ª–∞–¥–∏–º–∏—Ä\n‚Ä¢ –ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥\n‚Ä¢ –ß–µ–±–æ–∫—Å–∞—Ä—ã\n‚Ä¢ –ö–∞–∑–∞–Ω—å";
      if (LANG === "tr") return "Rota:\n‚Ä¢ Moskova\n‚Ä¢ Vladimir\n‚Ä¢ Nijni Novgorod\n‚Ä¢ √áeboksarƒ±\n‚Ä¢ Kazan";
      return "Route:\n‚Ä¢ Moscow\n‚Ä¢ Vladimir\n‚Ä¢ Nizhny Novgorod\n‚Ä¢ Cheboksary\n‚Ä¢ Kazan";
    }

    // =========================
    // State machine
    // =========================
    const state = {
      flow: null, // watch|crew|sleep|flyover|aircraft|null
      step: null,
      watch: { dur:null, genre:null, format:null }
    };

    function resetFlow(){
      state.flow = null;
      state.step = null;
      state.watch = { dur:null, genre:null, format:null };
    }

    function startFlow(flow){
      state.flow = flow;
      state.step = null;

      if (flow === 'watch'){
        state.step = 'dur';
        aeroSay(t().watchAskDuration, chipsDuration());
        return true;
      }
      if (flow === 'crew'){
        state.step = 'crewPick';
        aeroSay(t().crewAsk, chipsCrew());
        return true;
      }
      if (flow === 'sleep'){
        state.step = 'sleep';
        aeroSay(t().sleepAsk, [
          {label: "5", value:'sleep:5'},
          {label: "10", value:'sleep:10'}
        ]);
        return true;
      }
      if (flow === 'flyover'){
        state.step = 'fly';
        aeroSay(t().flyAsk, [
          {label: t().flyListBtn, value:'fly:list'},
          {label: t().flyNowBtn, value:'fly:now'}
        ]);
        return true;
      }
      if (flow === 'aircraft'){
        state.step = 'air';
        aeroSay(t().airAsk, [
          {label: t().airSpeedBtn, value:'air:speed'},
          {label: t().airTurbBtn, value:'air:turb'}
        ]);
        return true;
      }

      resetFlow();
      return false;
    }

    function crewPhraseByValue(v){
      const c = t().crew;
      const map = {
        'crew:water': c.water,
        'crew:pillow': c.pillow,
        'crew:dinner': c.dinner,
        'crew:kids': c.kids
      };
      return map[v] || null;
    }

    function handleInternal(value){
      if (!value) return false;

      if (value.startsWith('start:')) return startFlow(value.split(':')[1]);

      // crew
      if (value === 'crew:done'){ aeroSay(t().crew.ok, chipsMainMenu()); resetFlow(); return true; }
      if (value === 'crew:more'){ state.flow='crew'; state.step='crewPick'; aeroSay(t().crewAsk, chipsCrew()); return true; }
      if (value.startsWith('crew:')){
        state.flow='crew'; state.step='crewDone';
        const phrase = crewPhraseByValue(value);
        if (!phrase){ errorPickFromList(chipsCrew()); return true; }
        aeroSay(t().crew.accepted(phrase), chipsCrewAfter());
        return true;
      }

      // watch (cards)
      if (value.startsWith('dur:')){
        if (state.flow !== 'watch' || state.step !== 'dur') return false;
        state.watch.dur = value.split(':')[1];
        state.step = 'genre';
        aeroSay(t().watchAskGenre, chipsGenre());
        return true;
      }
      if (value.startsWith('genre:')){
        if (state.flow !== 'watch' || state.step !== 'genre') return false;
        state.watch.genre = value.split(':')[1];
        state.step = 'format';
        aeroSay(t().watchAskFormat, chipsFormat());
        return true;
      }
      if (value.startsWith('format:')){
        if (state.flow !== 'watch' || state.step !== 'format') return false;
        state.watch.format = value.split(':')[1];

        // –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞ ‚Äî –∫–∞—Ä—Ç–æ—á–∫–∏
        const cardsNode = renderWatchCards(state.watch.genre, state.watch.format, state.watch.dur);
        aeroNode(cardsNode, chipsMainMenu());

        resetFlow();
        return true;
      }

      // sleep
      if (value === 'sleep:5'){ aeroSay(t().sleep5, chipsMainMenu()); resetFlow(); return true; }
      if (value === 'sleep:10'){ aeroSay(t().sleep10, chipsMainMenu()); resetFlow(); return true; }

      // fly
      if (value === 'fly:list'){
        aeroSay(flyListText(), [{label: t().flyNowBtn, value:'fly:now'}]);
        return true;
      }
      if (value === 'fly:now'){
        aeroSay(flyNowText(), [
          {label: t().flyWhereBtn, value:'fly:now'},
          {label: t().flyRouteBtn, value:'fly:list'}
        ]);
        return true;
      }

      // aircraft
      if (value === 'air:speed'){ aeroSay(t().airSpeed, chipsMainMenu()); resetFlow(); return true; }
      if (value === 'air:turb'){ aeroSay(t().airTurb, chipsMainMenu()); resetFlow(); return true; }

      return false;
    }

    // =========================
    // Intent detection
    // =========================
    function detectIntent(text){
      const n = normalize(text);

      // hello
      if (n.includes('–ø—Ä–∏–≤–µ—Ç') || n.includes('–∑–¥—Ä–∞–≤') || n === 'hi' || n === 'hello' || n.includes('merhaba')) {
        return {type:'hello'};
      }

      // watch
      if (n.includes('—á—Ç–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å') || n.includes('—Ö–æ—á—É –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å') || n.includes('–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∏–ª—å–º') || n.includes('movie') || n.includes('film') || n.includes('dizi') || n.includes('izlemek')) {
        return {type:'start', flow:'watch'};
      }

      // crew
      if (n.includes('–±–æ—Ä—Ç–ø—Ä–æ–≤–æ–¥') || n.includes('–ø—Ä–æ–≤–æ–¥–Ω–∏–∫') || n.includes('crew') || n.includes('kabin')) return {type:'start', flow:'crew'};
      if (n.includes('–≤–æ–¥—É') || n.includes('water') || n.includes('su')) return {type:'internal', value:'crew:water'};
      if (n.includes('–ø–æ–¥—É—à') || n.includes('pillow') || n.includes('yast')) return {type:'internal', value:'crew:pillow'};
      if (n.includes('—É–∂–∏–Ω') || n.includes('dinner') || n.includes('ak≈üam')) return {type:'internal', value:'crew:dinner'};
      if ((n.includes('–¥–µ—Ç—Å–∫') && n.includes('–º–µ–Ω—é')) || n.includes('kids') || n.includes('√ßocuk')) return {type:'internal', value:'crew:kids'};
      if (n === '–≥–æ—Ç–æ–≤–æ' || n.includes('–≥–æ—Ç–æ–≤') || n === 'done' || n.includes('bitti')) return {type:'internal', value:'crew:done'};

      // fly
      if (n.includes('–≥–¥–µ –º—ã') || n.includes('where are we') || n.includes('neredey')) return {type:'internal', value:'fly:now'};
      if (n.includes('–º–∞—Ä—à—Ä—É—Ç') || n.includes('route') || n.includes('rota') || n.includes('–∫–∞–∫–∏–µ –≥–æ—Ä–æ–¥–∞')) return {type:'internal', value:'fly:list'};
      if (n.includes('–ø—Ä–æ–ª–µ—Ç–∞–µ–º') || n.includes('overfly')) return {type:'start', flow:'flyover'};

      // sleep
      if (n.includes('—É—Å–Ω—É—Ç—å') || n.includes('—Å–æ–Ω') || n.includes('sleep') || n.includes('uyku')) return {type:'start', flow:'sleep'};

      // aircraft
      if (n.includes('—Å–∞–º–æ–ª–µ—Ç') || n.includes('—Å–∞–º–æ–ª—ë—Ç') || n.includes('aircraft') || n.includes('u√ßak') || n.includes('turbu') || n.includes('—Çurb')) return {type:'start', flow:'aircraft'};

      // watch helpers (in-flow)
      if (n.includes('–∫–æ–º–µ–¥') || n.includes('comedy') || n.includes('komedi')) return {type:'internal', value:'genre:comedy'};
      if (n.includes('–¥–µ—Ç–µ–∫—Ç–∏–≤') || n.includes('thrill') || n.includes('gizem')) return {type:'internal', value:'genre:detective'};
      if (n.includes('–¥—Ä–∞–º') || n.includes('drama') || n.includes('dram')) return {type:'internal', value:'genre:drama'};
      if (n.includes('—Ñ–∞–Ω—Ç–∞—Å—Ç') || n.includes('sci') || n.includes('bilim')) return {type:'internal', value:'genre:scifi'};

      if (n === '—Ñ–∏–ª—å–º' || n.includes('movie') || n.includes(' film') || n === 'film') return {type:'internal', value:'format:film'};
      if (n === '—Å–µ—Ä–∏–∞–ª' || n.includes('series') || n.includes('dizi')) return {type:'internal', value:'format:series'};

      if (n.includes('–¥–æ 1') || n.includes('1 hour') || n.includes('1 saate')) return {type:'internal', value:'dur:short'};
      if (n.includes('1-2') || n.includes('1‚Äì2') || n.includes('2 hours') || n.includes('1‚Äì2 saat')) return {type:'internal', value:'dur:mid'};
      if (n.includes('2-4') || n.includes('2‚Äì4') || n.includes('4 hours') || n.includes('2‚Äì4 saat')) return {type:'internal', value:'dur:long'};
      if (n.includes('–±–æ–ª—å—à–µ') || n.includes('over 4') || n.includes('4 saatten')) return {type:'internal', value:'dur:xl'};

      return null;
    }

    // =========================
    // Main handler (no online AI yet)
    // =========================
    async function onUserUtterance(text, opts){
      const { internalValue = null, alreadyRenderedUser = false } = opts || {};
      const clean = (text || "").trim();
      if (!clean) return;

      if (!alreadyRenderedUser) userSay(clean);

      // internal
      if (internalValue){
        const ok = handleInternal(internalValue);
        if (!ok) errorPickFromList(chipsMainMenu());
        return;
      }

      const intent = detectIntent(clean);

      if (intent?.type === 'hello'){
        aeroSay(t().hi, chipsMainMenu());
        return;
      }

      if (intent?.type === 'start'){
        const ok = startFlow(intent.flow);
        if (!ok) errorPickFromList(chipsMainMenu());
        return;
      }

      if (intent?.type === 'internal'){
        const ok = handleInternal(intent.value);
        if (!ok) errorPickFromList(chipsMainMenu());
        return;
      }

      // strict flows
      if (state.flow === 'watch'){
        errorPickFromList(
          state.step === 'dur' ? chipsDuration() :
          state.step === 'genre' ? chipsGenre() :
          state.step === 'format' ? chipsFormat() :
          chipsMainMenu()
        );
        return;
      }
      if (state.flow === 'crew'){
        errorPickFromList(state.step === 'crewDone' ? chipsCrewAfter() : chipsCrew());
        return;
      }

      errorPickFromList(chipsMainMenu());
    }

    // =========================
    // UI: send
    // =========================
    function send(){
      const text = inputEl.value.trim();
      if (!text) return;
      inputEl.value = '';
      onUserUtterance(text, { alreadyRenderedUser: false });
    }
    sendEl.addEventListener('click', send);
    inputEl.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') send(); });

    // =========================
    // Sheet
    // =========================
    function openSheet(){ overlayEl.classList.add('open'); overlayEl.setAttribute('aria-hidden','false'); }
    function closeSheet(){ overlayEl.classList.remove('open'); overlayEl.setAttribute('aria-hidden','true'); }
    plusEl.addEventListener('click', ()=> overlayEl.classList.contains('open') ? closeSheet() : openSheet());
    closeSheetEl.addEventListener('click', closeSheet);
    overlayEl.addEventListener('click', (e)=>{ if (e.target === overlayEl) closeSheet(); });
    overlayEl.querySelectorAll('[data-action]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        closeSheet();
        startFlow(btn.getAttribute('data-action'));
      });
    });

    // =========================
    // Drawer + nav links
    // =========================
    function openDrawer(){ drawerOverlayEl.classList.add('open'); drawerOverlayEl.setAttribute('aria-hidden','false'); }
    function closeDrawer(){ drawerOverlayEl.classList.remove('open'); drawerOverlayEl.setAttribute('aria-hidden','true'); }
    burgerEl.addEventListener('click', openDrawer);
    drawerCloseEl.addEventListener('click', closeDrawer);
    drawerOverlayEl.addEventListener('click', (e)=>{ if (e.target === drawerOverlayEl) closeDrawer(); });

    document.querySelectorAll('.navItem').forEach(item => {
      item.addEventListener('click', () => {
        const page = item.getAttribute('data-page');

        document.querySelectorAll('.navItem').forEach(x => x.classList.remove('active'));
        item.classList.add('active');

        closeDrawer();

        if (page === "entertainment" || page === "map3d") {
          window.open(NAV_LINKS[page], "_blank", "noopener,noreferrer");
        }
      });
    });

    // =========================
    // Quick buttons
    // =========================
    crewBtnFixedEl.addEventListener('click', ()=> startFlow('crew'));

    // =========================
    // Voice: continuous SpeechRecognition
    // =========================
    const Voice = { supported:false, active:false, rec:null };

    function setupVoice(){
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SR) return;
      Voice.supported = true;

      const rec = new SR();
      rec.lang = (LANG === "ru") ? 'ru-RU' : (LANG === "tr" ? 'tr-TR' : 'en-US');
      rec.continuous = true;
      rec.interimResults = false;
      rec.maxAlternatives = 1;
      Voice.rec = rec;

      rec.onresult = async (event) => {
        const last = event.results[event.results.length - 1];
        const transcript = (last && last[0] && last[0].transcript) ? last[0].transcript.trim() : "";
        if (!transcript) return;
        await onUserUtterance(transcript, { alreadyRenderedUser: false });
      };

      rec.onerror = () => { stopVoice(); };

      rec.onend = () => {
        if (Voice.active){
          try { rec.start(); } catch(e) {}
        }
      };
    }

    function startVoice(){
      if (!Voice.supported){
        errorPickFromList(chipsMainMenu());
        return;
      }
      Voice.active = true;
      voiceBtnEl.classList.add('voice-on');
      voiceBtnEl.textContent = t().voiceStop;

      try { if (Voice.rec) Voice.rec.lang = (LANG === "ru") ? 'ru-RU' : (LANG === "tr" ? 'tr-TR' : 'en-US'); } catch(e) {}
      try { Voice.rec.start(); } catch(e) {}

      aeroSay(t().voiceOn, chipsMainMenu());
    }

    function stopVoice(){
      Voice.active = false;
      voiceBtnEl.classList.remove('voice-on');
      voiceBtnEl.textContent = t().voiceStart;
      if (Voice.rec){
        try { Voice.rec.stop(); } catch(e) {}
      }
    }

    voiceBtnEl.addEventListener('click', ()=>{ if (!Voice.active) startVoice(); else stopVoice(); });

    // =========================
    // Apply language
    // =========================
    function applyLanguage(){
      ui.titleH1.textContent = t().title;
      emptyHintEl.textContent = t().emptyHint;
      inputEl.placeholder = t().placeholder;

      crewBtnFixedEl.textContent = t().quickCrew;
      voiceBtnEl.textContent = Voice.active ? t().voiceStop : t().voiceStart;

      ui.drawerTitle.textContent = t().drawerTitle;
      ui.langTitle.textContent = t().langTitle;

      ui.navAerofriend.textContent = t().navAerofriend;
      ui.navAerofriendSub.textContent = t().navAerofriendSub;
      ui.navEnt.textContent = t().navEnt;
      ui.navEntSub.textContent = t().navEntSub;
      ui.navMap.textContent = t().navMap;
      ui.navMapSub.textContent = t().navMapSub;

      ui.sheetTitle.textContent = t().sheetTitle;
      ui.sheetSubtitle.textContent = t().sheetSubtitle;
      ui.sheetWatchTitle.textContent = t().sheetWatchTitle;
      ui.sheetWatchDesc.textContent = t().sheetWatchDesc;
      ui.sheetSleepTitle.textContent = t().sheetSleepTitle;
      ui.sheetSleepDesc.textContent = t().sheetSleepDesc;
      ui.sheetFlyTitle.textContent = t().sheetFlyTitle;
      ui.sheetFlyDesc.textContent = t().sheetFlyDesc;
      ui.sheetAirTitle.textContent = t().sheetAirTitle;
      ui.sheetAirDesc.textContent = t().sheetAirDesc;

      try { if (Voice.rec) Voice.rec.lang = (LANG === "ru") ? 'ru-RU' : (LANG === "tr" ? 'tr-TR' : 'en-US'); } catch(e) {}
    }

    document.querySelectorAll(".langBtn").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".langBtn").forEach(x => x.classList.remove("active"));
        btn.classList.add("active");
        LANG = btn.getAttribute("data-lang") || "ru";
        applyLanguage();
      });
    });

    // init
    window.addEventListener('load', ()=>{
      applyLanguage();
      inputEl.focus();
      setupVoice();
    });
  </script>
</body>
</html>












