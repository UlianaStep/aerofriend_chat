<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ĞÑÑ€Ğ¾Ğ´Ñ€ÑƒĞ³ â€” Ñ‡Ğ°Ñ‚ (Ğ´ĞµĞ¼Ğ¾)</title>

  <style>
    :root{
      --bgTop:#0b4f87;
      --bgMid:#083a6d;
      --bgBot:#062a55;

      --text:#fff;
      --muted:rgba(255,255,255,.70);

      --bubble-bot: rgba(255,255,255,.14);
      --bubble-user:#f28a2a;

      --stroke: rgba(255,255,255,.14);

      --input-bg: rgba(255,255,255,.16);
      --input-stroke: rgba(255,255,255,.16);

      --btn-bg: rgba(255,255,255,.10);
      --btn-stroke: rgba(255,255,255,.18);

      --overlay: rgba(0,0,0,.38);
      --panel: rgba(7, 40, 80, .92);
      --panel-stroke: rgba(255,255,255,.14);

      --radius:18px;

      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);

      --header-h: 88px;
      --composer-h: 92px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 900px at 35% 25%, var(--bgTop) 0%, var(--bgMid) 45%, var(--bgBot) 100%);
      overflow:hidden;
    }

    .app{
      height:100%;
      display:flex;
      flex-direction:column;
    }

    /* ===== Header ===== */
    header{
      height: calc(var(--header-h) + var(--safe-top));
      padding: calc(14px + var(--safe-top)) 18px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(0,0,0,.14), rgba(0,0,0,0));
      backdrop-filter: blur(6px);
    }

    .icon-btn{
      width:46px;height:46px;
      border-radius:16px;
      border:1px solid var(--btn-stroke);
      background: var(--btn-bg);
      display:grid;
      place-items:center;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
      cursor:pointer;
      padding:0;
    }
    .icon-btn img{ width:22px;height:22px; object-fit:contain; display:block; }

    .brand{ display:flex; align-items:center; gap:10px; }
    .brand img{ height:22px; width:auto; display:block; }

    /* ===== Title ===== */
    .titlebar{ padding: 10px 20px 6px; }
    .titlebar h1{
      margin:0;
      font-size: 40px;
      font-weight: 800;
      letter-spacing:.2px;
      line-height:1.05;
    }

    /* ===== Chat area ===== */
    .chat{
      flex:1;
      display:flex;
      flex-direction:column;
      min-height:0;
      padding: 0 16px;
      position:relative;
    }

    .messages{
      flex:1;
      min-height:0;
      overflow:auto;
      padding: 8px 0 14px;
      -webkit-overflow-scrolling: touch;
      scroll-behavior:smooth;
    }
    .messages::-webkit-scrollbar{ width:8px; }
    .messages::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.18);
      border-radius: 10px;
    }

    .empty-hint{
      margin: 18px 0 0;
      padding: 14px 14px;
      border: 1px dashed rgba(255,255,255,.18);
      border-radius: 16px;
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.75);
      line-height: 1.35;
    }

    .msg{
      margin: 18px 0;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .msg.bot{ align-items:flex-start; }
    .msg.user{ align-items:flex-end; }

    .label{
      font-size: 11px;
      letter-spacing: .6px;
      text-transform: uppercase;
      color: rgba(255,255,255,.55);
      padding: 0 6px;
    }

    .bubble{
      max-width: 78%;
      padding: 14px 16px;
      border-radius: var(--radius);
      border: 1px solid var(--stroke);
      box-shadow: 0 10px 22px rgba(0,0,0,.14);
      backdrop-filter: blur(6px);
      line-height: 1.35;
      font-size: 16px;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .bot .bubble{
      background: var(--bubble-bot);
      border-bottom-left-radius: 10px;
    }

    .user .bubble{
      background: var(--bubble-user);
      border-color: rgba(255,255,255,.08);
      border-bottom-right-radius: 10px;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      padding: 0 6px;
      margin-top: 4px;
    }
    .chip{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.92);
      border-radius: 14px;
      padding: 10px 12px;
      font-size: 14px;
      cursor:pointer;
      box-shadow: 0 10px 20px rgba(0,0,0,.12);
      user-select:none;
    }
    .chip:active{ transform: translateY(1px); }

    /* ===== Composer ===== */
    .composer{
      height: calc(var(--composer-h) + var(--safe-bottom));
      padding: 12px 16px calc(12px + var(--safe-bottom));
      display:flex;
      align-items:center;
      gap:12px;
      position:relative;
      z-index:3;
    }

    .plus{
      width:54px;height:54px;
      border-radius: 16px;
      border: 1px solid var(--btn-stroke);
      background: rgba(255,255,255,.10);
      display:grid;
      place-items:center;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
      cursor:pointer;
      padding:0;
    }
    .plus img{ width:22px;height:22px; display:block; }

    .input{
      flex:1;
      height:54px;
      border-radius: 18px;
      border: 1px solid var(--input-stroke);
      background: var(--input-bg);
      color: var(--text);
      outline:none;
      padding: 0 16px;
      font-size: 17px;
      box-shadow: 0 10px 22px rgba(0,0,0,.16);
    }
    .input::placeholder{ color: rgba(255,255,255,.70); }

    .send{
      width:56px;height:54px;
      border-radius: 18px;
      border:none;
      background: var(--bubble-user);
      box-shadow: 0 12px 24px rgba(0,0,0,.22);
      display:grid;
      place-items:center;
      cursor:pointer;
      padding:0;
    }
    .send img{ width:22px;height:22px; display:block; }
    .send:disabled{
      filter: grayscale(.35) brightness(.9);
      cursor:not-allowed;
    }

    /* ===== Quick Actions Popup ===== */
    .overlay{
      position:absolute;
      inset:0;
      background: var(--overlay);
      backdrop-filter: blur(4px);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease;
      z-index:10;
    }
    .overlay.open{
      opacity:1;
      pointer-events:auto;
    }

    .sheet{
      position:absolute;
      left: 16px;
      right: 16px;
      bottom: calc(var(--composer-h) + 10px + var(--safe-bottom));
      border-radius: 22px;
      border: 1px solid var(--panel-stroke);
      background: var(--panel);
      box-shadow: 0 24px 60px rgba(0,0,0,.28);
      padding: 14px;
      transform: translateY(10px);
      opacity:0;
      transition: transform .18s ease, opacity .18s ease;
    }
    .overlay.open .sheet{
      transform: translateY(0);
      opacity:1;
    }

    .sheet-title{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding: 4px 4px 10px;
    }
    .sheet-title h2{
      margin:0;
      font-size: 28px;
      font-weight: 900;
      letter-spacing:.2px;
      color:#fff;
    }
    .sheet-title p{
      margin:6px 0 0;
      color: rgba(255,255,255,.78);
      font-size: 18px;
      line-height: 1.25;
    }
    .sheet-close{
      width:52px;height:52px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: rgba(255,255,255,.92);
      cursor:pointer;
      font-size: 30px;
      line-height: 1;
      display:grid;
      place-items:center;
    }

    .actions{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
      margin-top: 10px;
    }

    /* Ğ’ĞĞ–ĞĞ: text color = white + ĞºĞ»Ğ¸ĞºĞ°Ğ±ĞµĞ»ÑŒĞ½Ğ° Ğ²ÑÑ Ğ¿Ğ»Ğ°ÑˆĞºĞ° */
    .action-card{
      width:100%;
      text-align:left;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.10);
      border-radius: 22px;
      padding: 16px 16px;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:12px;
      color:#fff;
    }
    .action-card:active{ transform: translateY(1px); }

    .action-main{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width:0;
    }
    .action-name{
      font-weight: 900;
      font-size: 22px;
      line-height: 1.1;
      color:#fff;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .action-desc{
      font-size: 18px;
      color: rgba(255,255,255,.78);
      line-height: 1.2;
    }

    .crew-btn{
      margin-top: 14px;
      width:100%;
      border:none;
      border-radius: 22px;
      background: var(--bubble-user);
      color:#fff;
      font-weight: 900;
      letter-spacing:.2px;
      padding: 18px 14px;
      cursor:pointer;
      box-shadow: 0 14px 28px rgba(0,0,0,.22);
      font-size: 22px;
    }
    .crew-btn:active{ transform: translateY(1px); }

    /* ===== Tablet landscape ===== */
    @media (min-width: 820px) and (orientation: landscape){
      .app{ align-items:center; }
      header,.titlebar,.chat,.composer{
        width: min(920px, 92vw);
      }
      .bubble{ max-width: 62%; }
      .titlebar h1{ font-size: 44px; }
      .sheet{ left: 0; right: 0; }
    }

    @media (max-width: 360px){
      .titlebar h1{ font-size: 36px; }
      .bubble{ font-size: 15px; }
      .sheet-title h2{ font-size: 22px; }
      .sheet-title p, .action-desc{ font-size: 15px; }
      .action-name{ font-size: 18px; }
      .crew-btn{ font-size: 18px; }
    }
  </style>
</head>

<body>
  <div class="app">

    <header>
      <button class="icon-btn" type="button" aria-label="ĞœĞµĞ½Ñ">
        <img src="Icon/Burger-menu.svg" alt="" />
      </button>

      <div class="brand" aria-label="Aeroflot">
        <img src="Logo/CMYK.svg" alt="AEROFLOT" />
      </div>
    </header>

    <div class="titlebar">
      <h1>ĞÑÑ€Ğ¾Ğ´Ñ€ÑƒĞ³</h1>
    </div>

    <main class="chat">
      <div id="messages" class="messages" role="log" aria-live="polite" aria-relevant="additions">
        <div id="emptyHint" class="empty-hint">
          ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Â«+Â» Ğ´Ğ»Ñ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸ĞµĞ² Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ â€” Ñ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ñƒ Ğ¿Ğ¾ Ñ…Ğ¾Ğ´Ñƒ Ğ¿Ğ¾Ğ»Ñ‘Ñ‚Ğ°.
        </div>
      </div>

      <!-- Overlay + Sheet -->
      <div id="overlay" class="overlay" aria-hidden="true">
        <div class="sheet" role="dialog" aria-label="Ğ§Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ² Ğ¿Ğ¾Ğ»Ñ‘Ñ‚Ğµ">
          <div class="sheet-title">
            <div>
              <h2>Ğ§Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ² Ğ¿Ğ¾Ğ»Ñ‘Ñ‚Ğµ</h2>
              <p>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ â€” Ñ Ğ·Ğ°Ğ´Ğ°Ğ¼ Ğ¿Ğ°Ñ€Ñƒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ¸ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶Ñƒ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚.</p>
            </div>
            <button id="closeSheet" class="sheet-close" type="button" aria-label="Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ">Ã—</button>
          </div>

          <div class="actions">
            <button class="action-card" type="button" data-action="watch">
              <div class="action-main">
                <div class="action-name">ğŸ¬ ĞŸĞ¾Ğ´Ğ±Ğ¾Ñ€ĞºĞ° Ğ½Ğ° ÑÑ‚Ğ¾Ñ‚ Ñ€ĞµĞ¹Ñ</div>
                <div class="action-desc">Ğ¤Ğ¸Ğ»ÑŒĞ¼ Ğ¸Ğ»Ğ¸ ÑĞµÑ€Ğ¸Ğ°Ğ» Ğ¿Ğ¾Ğ´ Ğ´Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ»Ñ‘Ñ‚Ğ° Ğ¸ Ğ²ĞºÑƒÑ.</div>
              </div>
            </button>

            <button class="action-card" type="button" data-action="sleep">
              <div class="action-main">
                <div class="action-name">ğŸŒ™ ĞœÑĞ³ĞºĞ¾ ÑƒÑĞ½ÑƒÑ‚ÑŒ</div>
                <div class="action-desc">Ğ”Ñ‹Ñ…Ğ°Ğ½Ğ¸Ğµ, Ñ€Ğ°ÑÑĞ»Ğ°Ğ±Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸ â€œĞ²Ñ‹ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ñ‹â€.</div>
              </div>
            </button>

            <button class="action-card" type="button" data-action="flyover">
              <div class="action-main">
                <div class="action-name">ğŸ—ºï¸ Ğ§Ñ‚Ğ¾ Ğ¼Ñ‹ Ğ¿Ñ€Ğ¾Ğ»ĞµÑ‚Ğ°ĞµĞ¼</div>
                <div class="action-desc">ĞŸĞ¾Ğ´ÑĞºĞ°Ğ¶Ñƒ Ğ¾Ñ€Ğ¸ĞµĞ½Ñ‚Ğ¸Ñ€Ñ‹ Ğ¿Ğ¾ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ñƒ.</div>
              </div>
            </button>

            <button class="action-card" type="button" data-action="aircraft">
              <div class="action-main">
                <div class="action-name">âœˆï¸ Ğ˜Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ğ¾Ğµ Ğ¾ ÑĞ°Ğ¼Ğ¾Ğ»Ñ‘Ñ‚Ğµ</div>
                <div class="action-desc">Ğ¤Ğ°ĞºÑ‚Ñ‹ Ğ¿Ñ€Ğ¾ Ğ¿Ğ¾Ğ»Ñ‘Ñ‚, Ğ²Ñ‹ÑĞ¾Ñ‚Ñƒ, ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹.</div>
              </div>
            </button>
          </div>

          <button id="crewBtn" class="crew-btn" type="button">
            Ğ¡Ğ²ÑĞ·ÑŒ Ñ Ğ±Ğ¾Ñ€Ñ‚Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ½Ğ¸ĞºĞ¾Ğ¼
          </button>
        </div>
      </div>

      <div class="composer">
        <button id="plus" class="plus" type="button" aria-label="Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸">
          <img src="Icon/Plus.svg" alt="" />
        </button>

        <input id="input" class="input" type="text" placeholder="Ğ¡Ğ¿Ñ€Ğ¾ÑĞ¸ Ğ¼ĞµĞ½Ñ" autocomplete="off" />

        <button id="send" class="send" type="button" aria-label="ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ">
          <img src="Icon/TextButton/arrow-up_20x20.svg" alt="" />
        </button>
      </div>
    </main>

  </div>

  <script>
    const messagesEl = document.getElementById('messages');
    const emptyHintEl = document.getElementById('emptyHint');
    const inputEl = document.getElementById('input');
    const sendEl = document.getElementById('send');

    const plusEl = document.getElementById('plus');
    const overlayEl = document.getElementById('overlay');
    const closeSheetEl = document.getElementById('closeSheet');
    const crewBtnEl = document.getElementById('crewBtn');

    // ====== Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ¾Ğ² ======
    let state = {
      activeFlow: null,  // null | 'watch' | 'sleep' | 'flyover' | 'aircraft' | 'crew'
      step: null,
      data: {}
    };

    function hideEmptyHint(){
      if (emptyHintEl) emptyHintEl.style.display = 'none';
    }

    function addMessage({from, text, chips}){
      hideEmptyHint();

      const msg = document.createElement('div');
      msg.className = `msg ${from}`;

      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = (from === 'bot') ? 'ĞĞ­Ğ ĞĞ”Ğ Ğ£Ğ“' : 'Ğ’Ñ‹';

      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = text;

      msg.appendChild(label);
      msg.appendChild(bubble);

      if (Array.isArray(chips) && chips.length){
        const chipsWrap = document.createElement('div');
        chipsWrap.className = 'chips';
        for (const c of chips){
          const b = document.createElement('button');
          b.className = 'chip';
          b.type = 'button';
          b.textContent = c.label;
          b.addEventListener('click', () => {
            handleUserInput(c.value, true);
          });
          chipsWrap.appendChild(b);
        }
        msg.appendChild(chipsWrap);
      }

      messagesEl.appendChild(msg);
      requestAnimationFrame(() => {
        messagesEl.scrollTop = messagesEl.scrollHeight;
      });
    }

    // Ğ¡Ñ‚Ğ¸Ğ»ÑŒ "ĞÑÑ€Ğ¾Ğ´Ñ€ÑƒĞ³Ğ°": ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾, ÑĞ¿Ğ¾ĞºĞ¾Ğ¹Ğ½Ğ¾, Ğ¿Ğ¾ Ğ´ĞµĞ»Ñƒ.
    function aeroSay(text, chips){ addMessage({from:'bot', text, chips}); }
    function userSay(text){ addMessage({from:'user', text}); }

    function openSheet(){
      overlayEl.classList.add('open');
      overlayEl.setAttribute('aria-hidden','false');
    }
    function closeSheet(){
      overlayEl.classList.remove('open');
      overlayEl.setAttribute('aria-hidden','true');
    }

    plusEl.addEventListener('click', () => {
      if (overlayEl.classList.contains('open')) closeSheet();
      else openSheet();
    });
    closeSheetEl.addEventListener('click', closeSheet);
    overlayEl.addEventListener('click', (e) => {
      if (e.target === overlayEl) closeSheet();
    });

    // ====== Ğ¡Ñ‚Ğ°Ñ€Ñ‚ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸ĞµĞ² ======
    overlayEl.querySelectorAll('[data-action]').forEach(btn => {
      btn.addEventListener('click', () => {
        const action = btn.getAttribute('data-action');
        closeSheet();
        startFlow(action);
      });
    });
    crewBtnEl.addEventListener('click', () => {
      closeSheet();
      startFlow('crew');
    });

    function normalize(s){
      return (s || '').toLowerCase().replace(/Ñ‘/g,'Ğµ').trim();
    }

    // --- Ğ§Ñ‚Ğ¾ Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ: Ğ·Ğ°Ñ€Ğ°Ğ½ĞµĞµ Ğ·Ğ°ÑˆĞ¸Ñ‚Ñ‹Ğµ ĞºĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ğµ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹ ---
    // Ğ’Ğ°Ğ¶Ğ½Ğ¾: ÑÑ‚Ğ¾ Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ â€œĞ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹â€, Ğ´Ğ¾ ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ´Ğ¾Ğ¹Ñ‚Ğ¸.
    const watchLibrary = {
      // bucket: short (<=90), mid (90-160), long (>=160) â€” ÑƒÑĞ»Ğ¾Ğ²Ğ½Ğ¾
      short: {
        comedy: {
          film: [
            'Â«The Grand Budapest HotelÂ» â€” Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡Ğ½Ğ¾ Ğ¸ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¾.',
            'Â«Palm SpringsÂ» â€” Ğ»Ñ‘Ğ³ĞºĞ°Ñ Ñ„Ğ°Ğ½Ñ‚Ğ°ÑÑ‚Ğ¸Ñ‡ĞµÑĞºĞ°Ñ ĞºĞ¾Ğ¼ĞµĞ´Ğ¸Ñ.',
            'Â«PaddingtonÂ» â€” Ğ´Ğ¾Ğ±Ñ€Ñ‹Ğ¹ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ â€œĞ´Ğ»Ñ Ğ¾Ñ‚Ğ´Ñ‹Ñ…Ğ°â€.'
          ],
          series: [
            'Â«The OfficeÂ» (US) â€” 2â€“3 ÑĞµÑ€Ğ¸Ğ¸ Ğ¿Ğ¾ 20â€“25 Ğ¼Ğ¸Ğ½ÑƒÑ‚.',
            'Â«Modern FamilyÂ» â€” Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğµ ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ñ‹.',
            'Â«Brooklyn Nine-NineÂ» â€” Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ ÑĞ¼Ğ¾Ñ€, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ĞºÑƒÑĞ¾Ñ‡ĞºĞ°Ğ¼Ğ¸.'
          ]
        },
        detective: {
          film: [
            'Â«Knives OutÂ» â€” Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ¸Ğ² Ñ Ñ‚ĞµĞ¼Ğ¿Ğ¾Ğ¼.',
            'Â«Sherlock HolmesÂ» (2009) â€” Ğ¿Ñ€Ğ¸ĞºĞ»ÑÑ‡ĞµĞ½Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ¸Ğ².',
            'Â«The Girl with the Dragon TattooÂ» â€” Ğ¼Ñ€Ğ°Ñ‡Ğ½ĞµĞµ, Ğ½Ğ¾ Ñ†ĞµĞ¿Ğ»ÑĞµÑ‚.'
          ],
          series: [
            'Â«SherlockÂ» â€” 1 ÑĞµÑ€Ğ¸Ñ (ĞºĞ°Ğº Ñ„Ğ¸Ğ»ÑŒĞ¼).',
            'Â«Only Murders in the BuildingÂ» â€” 2â€“3 ÑĞµÑ€Ğ¸Ğ¸.',
            'Â«True DetectiveÂ» â€” Ğ»ÑƒÑ‡ÑˆĞµ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ, ĞµÑĞ»Ğ¸ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğº Ğ¼Ñ€Ğ°Ñ‡Ğ½Ğ¾Ğ¼Ñƒ Ñ‚Ğ¾Ğ½Ñƒ.'
          ]
        },
        drama: {
          film: [
            'Â«WhiplashÂ» â€” ÑĞ¸Ğ»ÑŒĞ½Ğ°Ñ ÑĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ¸ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ Ñ…Ñ€Ğ¾Ğ½Ğ¾Ğ¼ĞµÑ‚Ñ€Ğ°Ğ¶.',
            'Â«The Truman ShowÂ» â€” Ğ»Ñ‘Ğ³ĞºĞ°Ñ Ñ„Ğ¸Ğ»Ğ¾ÑĞ¾Ñ„Ğ¸Ñ.',
            'Â«Little Miss SunshineÂ» â€” Ñ‚Ñ‘Ğ¿Ğ»Ğ°Ñ Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°-Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ.'
          ],
          series: [
            'Â«The BearÂ» â€” 2â€“3 ÑĞµÑ€Ğ¸Ğ¸, Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ.',
            'Â«FleabagÂ» â€” ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾ Ğ¸ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾.',
            'Â«ChernobylÂ» â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğº Ñ‚ÑĞ¶Ñ‘Ğ»Ğ¾Ğ¹ Ñ‚ĞµĞ¼Ğµ.'
          ]
        },
        scifi: {
          film: [
            'Â«Source CodeÂ» â€” ĞºĞ¾Ğ¼Ğ¿Ğ°ĞºÑ‚Ğ½Ñ‹Ğ¹ sci-fi Ñ‚Ñ€Ğ¸Ğ»Ğ»ĞµÑ€.',
            'Â«Edge of TomorrowÂ» â€” ÑĞºÑˆĞµĞ½ Ñ Ğ¸Ğ´ĞµĞµĞ¹.',
            'Â«HerÂ» â€” ÑĞ¿Ğ¾ĞºĞ¾Ğ¹Ğ½Ğ°Ñ Ñ„Ğ°Ğ½Ñ‚Ğ°ÑÑ‚Ğ¸ĞºĞ°.'
          ],
          series: [
            'Â«Black MirrorÂ» â€” 1 ÑĞ°Ğ¼Ğ¾ÑÑ‚Ğ¾ÑÑ‚ĞµĞ»ÑŒĞ½Ğ°Ñ ÑĞµÑ€Ğ¸Ñ.',
            'Â«Love, Death & RobotsÂ» â€” Ğ¼Ğ¸Ğ½Ğ¸-ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´Ñ‹.',
            'Â«Stranger ThingsÂ» â€” Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ 1â€“2 ÑĞµÑ€Ğ¸Ğ¸.'
          ]
        }
      },
      mid: {
        comedy: {
          film: [
            'Â«The InternÂ» â€” Ñ€Ğ¾Ğ²Ğ½Ğ¾ Ğ¸ Ğ´Ğ¾Ğ±Ñ€Ğ¾Ğ¶ĞµĞ»Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾.',
            'Â«Free GuyÂ» â€” Ğ»Ñ‘Ğ³ĞºĞ¸Ğ¹ ÑĞºÑˆĞµĞ½-ÑĞ¼Ğ¾Ñ€.',
            'Â«ChefÂ» â€” ĞºĞ¾Ğ¼Ñ„Ğ¾Ñ€Ñ‚Ğ½Ñ‹Ğ¹ Ñ„Ğ¸Ğ»ÑŒĞ¼.'
          ],
          series: [
            'Â«Ted LassoÂ» â€” 2â€“4 ÑĞµÑ€Ğ¸Ğ¸.',
            'Â«FriendsÂ» â€” Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¾Ğ¹ â€œĞ¿Ğ°ĞºĞµÑ‚â€ ÑĞµÑ€Ğ¸Ğ¹.',
            'Â«How I Met Your MotherÂ» â€” 3â€“5 ÑĞµÑ€Ğ¸Ğ¹.'
          ]
        },
        detective: {
          film: [
            'Â«PrisonersÂ» â€” Ğ½Ğ°Ğ¿Ñ€ÑĞ¶Ñ‘Ğ½Ğ½Ñ‹Ğ¹ Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ¸Ğ².',
            'Â«ZodiacÂ» â€” Ñ€Ğ°ÑÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ Ğ°Ñ‚Ğ¼Ğ¾ÑÑ„ĞµÑ€Ğ°.',
            'Â«Gone GirlÂ» â€” ÑÑĞ¶ĞµÑ‚Ğ½Ñ‹Ğµ Ğ¿Ğ¾Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ñ‹.'
          ],
          series: [
            'Â«MindhunterÂ» â€” 2â€“3 ÑĞµÑ€Ğ¸Ğ¸ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾.',
            'Â«Mare of EasttownÂ» â€” 2 ÑĞµÑ€Ğ¸Ğ¸ (ĞµÑĞ»Ğ¸ Ğ½Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑÑ Ğ´Ñ€Ğ°Ğ¼Ğ°-Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ¸Ğ²).',
            'Â«BroadchurchÂ» â€” 2â€“3 ÑĞµÑ€Ğ¸Ğ¸.'
          ]
        },
        drama: {
          film: [
            'Â«The Social NetworkÂ» â€” Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡Ğ½Ğ°Ñ Ğ´Ñ€Ğ°Ğ¼Ğ°.',
            'Â«ArrivalÂ» â€” Ğ¼ÑĞ³ĞºĞ°Ñ Ñ„Ğ°Ğ½Ñ‚Ğ°ÑÑ‚Ğ¸ĞºĞ°-Ğ´Ñ€Ğ°Ğ¼Ğ°.',
            'Â«La La LandÂ» â€” ĞµÑĞ»Ğ¸ Ñ…Ğ¾Ñ‡ĞµÑ‚ÑÑ Ğ¼ÑƒĞ·Ñ‹ĞºĞ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸.'
          ],
          series: [
            'Â«The Queenâ€™s GambitÂ» â€” 1â€“2 ÑĞµÑ€Ğ¸Ğ¸, Ğ·Ğ°Ñ‚ÑĞ³Ğ¸Ğ²Ğ°ĞµÑ‚.',
            'Â«SeveranceÂ» â€” 2 ÑĞµÑ€Ğ¸Ğ¸, Ğ¸Ğ½Ñ‚Ñ€Ğ¸Ğ³Ğ°.',
            'Â«The CrownÂ» â€” 1â€“2 ÑĞµÑ€Ğ¸Ğ¸ ÑĞ¿Ğ¾ĞºĞ¾Ğ¹Ğ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµĞ¼Ğ¿Ğ°.'
          ]
        },
        scifi: {
          film: [
            'Â«InterstellarÂ» â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ¿Ñ€Ğ¾Ñ‚Ğ¸Ğ² Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğ³Ğ¾ (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ñ‡Ğ°ÑÑ‚ÑĞ¼Ğ¸).',
            'Â«Ex MachinaÂ» â€” ĞºĞ°Ğ¼ĞµÑ€Ğ½Ğ°Ñ Ñ„Ğ°Ğ½Ñ‚Ğ°ÑÑ‚Ğ¸ĞºĞ°.',
            'Â«The MartianÂ» â€” ĞºĞ¾Ğ¼Ñ„Ğ¾Ñ€Ñ‚Ğ½Ñ‹Ğ¹ sci-fi.'
          ],
          series: [
            'Â«The ExpanseÂ» â€” 2â€“3 ÑĞµÑ€Ğ¸Ğ¸.',
            'Â«DarkÂ» â€” 1â€“2 ÑĞµÑ€Ğ¸Ğ¸ (Ğ²Ğ½Ğ¸Ğ¼Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾!).',
            'Â«WestworldÂ» (S1) â€” 1â€“2 ÑĞµÑ€Ğ¸Ğ¸.'
          ]
        }
      },
      long: {
        comedy: {
          film: [
            'Â«The Wolf of Wall StreetÂ» â€” Ğ´Ğ¾Ğ»Ğ³Ğ¾, Ğ½Ğ¾ Ğ»ĞµÑ‚Ğ¸Ñ‚ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ (18+).',
            'Â«Forrest GumpÂ» â€” Ğ±Ğ¾Ğ»ÑŒÑˆĞ°Ñ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ.',
            'Â«The Big LebowskiÂ» + ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ ÑĞ¿Ğ¸Ğ·Ğ¾Ğ´ ÑĞµÑ€Ğ¸Ğ°Ğ»Ğ° (ĞºĞ¾Ğ¼Ğ±Ğ¾).'
          ],
          series: [
            'ĞœĞ¸Ğ½Ğ¸-Ğ¼Ğ°Ñ€Ğ°Ñ„Ğ¾Ğ½ Â«The OfficeÂ» / Â«Modern FamilyÂ» â€” 6â€“8 ÑĞµÑ€Ğ¸Ğ¹.',
            'Â«Ted LassoÂ» â€” 5â€“6 ÑĞµÑ€Ğ¸Ğ¹.',
            'Â«Brooklyn Nine-NineÂ» â€” 7â€“9 ÑĞµÑ€Ğ¸Ğ¹.'
          ]
        },
        detective: {
          film: [
            'Â«The IrishmanÂ» â€” ĞµÑĞ»Ğ¸ Ğ½Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑÑ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾ Ğ¸ Ğ´Ğ¾Ğ»Ğ³Ğ¾.',
            'Â«The GodfatherÂ» (I) â€” ĞºĞ»Ğ°ÑÑĞ¸ĞºĞ° Ğ½Ğ° Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğ¹ Ğ¿ĞµÑ€ĞµĞ»Ñ‘Ñ‚.',
            'ĞšĞ¾Ğ¼Ğ±Ğ¾: Â«Knives OutÂ» + 2 ÑĞµÑ€Ğ¸Ğ¸ Â«Only Murdersâ€¦Â».'
          ],
          series: [
            'Â«True DetectiveÂ» â€” 4â€“5 ÑĞµÑ€Ğ¸Ğ¹ (Ğ¼Ñ€Ğ°Ñ‡Ğ½Ğ¾).',
            'Â«BroadchurchÂ» â€” 5â€“6 ÑĞµÑ€Ğ¸Ğ¹.',
            'Â«MindhunterÂ» â€” 4â€“5 ÑĞµÑ€Ğ¸Ğ¹.'
          ]
        },
        drama: {
          film: [
            'Â«OppenheimerÂ» â€” ĞºĞ¾Ğ½Ñ†ĞµĞ½Ñ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ´Ñ€Ğ°Ğ¼Ğ°.',
            'Â«DuneÂ» (2021) â€” Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ± Ğ¸ Ñ‚ĞµĞ¼Ğ¿.',
            'ĞšĞ¾Ğ¼Ğ±Ğ¾: Â«ArrivalÂ» + 2 ÑĞµÑ€Ğ¸Ğ¸ Â«The BearÂ».'
          ],
          series: [
            'Â«ChernobylÂ» â€” 4â€“5 ÑĞµÑ€Ğ¸Ğ¹ (Ñ‚ÑĞ¶Ñ‘Ğ»Ğ°Ñ Ñ‚ĞµĞ¼Ğ°).',
            'Â«The CrownÂ» â€” 4â€“5 ÑĞµÑ€Ğ¸Ğ¹.',
            'Â«SeveranceÂ» â€” 4â€“5 ÑĞµÑ€Ğ¸Ğ¹.'
          ]
        },
        scifi: {
          film: [
            'Â«InterstellarÂ» â€” Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾ â€œĞ½Ğ° Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾â€.',
            'Â«DuneÂ» â€” Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ½Ğ°Ñ Ñ„Ğ°Ğ½Ñ‚Ğ°ÑÑ‚Ğ¸ĞºĞ°.',
            'ĞšĞ¾Ğ¼Ğ±Ğ¾: Â«The MartianÂ» + 1 ÑĞµÑ€Ğ¸Ñ Â«Black MirrorÂ».'
          ],
          series: [
            'Â«The ExpanseÂ» â€” 5â€“6 ÑĞµÑ€Ğ¸Ğ¹.',
            'Â«DarkÂ» â€” 4 ÑĞµÑ€Ğ¸Ğ¸ (ĞµÑĞ»Ğ¸ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ ÑÑĞ¶ĞµÑ‚).',
            'Â«WestworldÂ» â€” 4â€“5 ÑĞµÑ€Ğ¸Ğ¹.'
          ]
        }
      }
    };

    function parseDuration(text){
      const t = normalize(text);

      if (t.startsWith('~')) return t;
      const hm = t.match(/^(\d{1,2})\s*:\s*(\d{1,2})$/);
      if (hm){
        const h = parseInt(hm[1],10);
        const m = parseInt(hm[2],10);
        if (!isNaN(h) && !isNaN(m)) return (h*60 + m);
      }
      const min = t.match(/(\d{1,4})\s*(Ğ¼Ğ¸Ğ½|Ğ¼)\b/);
      if (min){
        const m = parseInt(min[1],10);
        if (!isNaN(m)) return m;
      }
      const hr = t.match(/(\d{1,2})([.,]\d)?\s*(Ñ‡|Ñ‡Ğ°Ñ)/);
      if (hr){
        const h = parseInt(hr[1],10);
        if (!isNaN(h)) return (h*60);
      }
      return null;
    }

    function durationToBucket(d){
      // d Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ: number (minutes) Ğ¸Ğ»Ğ¸ ÑÑ‚Ñ€Ğ¾ĞºĞ° ~ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ
      if (typeof d === 'string'){
        if (d.includes('~1Ñ‡')) return 'short';
        if (d.includes('~1-2')) return 'short';
        if (d.includes('~2-4')) return 'mid';
        if (d.includes('~4+')) return 'long';
        return 'mid';
      }
      if (typeof d === 'number'){
        if (d <= 90) return 'short';
        if (d <= 160) return 'mid';
        return 'long';
      }
      return 'mid';
    }

    function genreToKey(g){
      const t = normalize(g);
      if (t.includes('ĞºĞ¾Ğ¼ĞµĞ´')) return 'comedy';
      if (t.includes('Ğ´ĞµÑ‚ĞµĞºÑ‚') || t.includes('Ñ‚Ñ€Ğ¸Ğ»')) return 'detective';
      if (t.includes('Ğ´Ñ€Ğ°Ğ¼')) return 'drama';
      if (t.includes('Ñ„Ğ°Ğ½Ñ‚Ğ°ÑÑ‚') || t.includes('sci') || t.includes('Ñ„ÑĞ½Ñ‚')) return 'scifi';
      // default
      return 'comedy';
    }

    function formatToKey(f){
      const t = normalize(f);
      if (t.includes('ÑĞµÑ€Ğ¸Ğ°Ğ»') || t.includes('Ğ¼Ğ¸Ğ½Ğ¸') || t.includes('ÑĞ¿Ğ¸Ğ·')) return 'series';
      return 'film';
    }

    function buildWatchResult(bucket, genreKey, formatKey){
      const list = watchLibrary[bucket][genreKey][formatKey] || [];
      const header =
        `Ğ’Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚ Ğ½Ğ° ÑÑ‚Ğ¾Ñ‚ Ğ¿ĞµÑ€ĞµĞ»Ñ‘Ñ‚ (${bucket === 'short' ? 'ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹' : bucket === 'mid' ? 'ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹' : 'Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğ¹'} ÑĞ»Ğ¾Ñ‚):`;
      return header + '\nâ€¢ ' + list.join('\nâ€¢ ');
    }

    // ====== Flyover: ĞšĞ°Ğ·Ğ°Ğ½ÑŒ â†’ ĞœĞ¾ÑĞºĞ²Ğ°, Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ³Ğ¾Ñ€Ğ¾Ğ´Ğ¾Ğ² Ğ¿Ğ¾ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ñƒ ======
    // Ğ£ÑĞ»Ğ¾Ğ²Ğ½Ñ‹Ğµ Ğ¾Ñ€Ğ¸ĞµĞ½Ñ‚Ğ¸Ñ€Ñ‹: Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹/Ğ™Ğ¾ÑˆĞºĞ°Ñ€-ĞĞ»Ğ°/ĞĞ¸Ğ¶Ğ½Ğ¸Ğ¹ ĞĞ¾Ğ²Ğ³Ğ¾Ñ€Ğ¾Ğ´/Ğ’Ğ»Ğ°Ğ´Ğ¸Ğ¼Ğ¸Ñ€/ĞœĞ¾ÑĞºĞ²Ğ°, Ğ’Ğ¾Ğ»Ğ³Ğ° Ğ¸ ĞĞºĞ°.
    function parseMinutesLoose(text){
      const t = normalize(text);
      const hm = t.match(/^(\d{1,2})\s*:\s*(\d{1,2})$/);
      if (hm){
        const h = parseInt(hm[1],10);
        const m = parseInt(hm[2],10);
        if (!isNaN(h) && !isNaN(m)) return (h*60 + m);
      }
      const min = t.match(/(\d{1,4})\s*(Ğ¼Ğ¸Ğ½|Ğ¼)\b/);
      if (min){
        const m = parseInt(min[1],10);
        if (!isNaN(m)) return m;
      }
      const hr = t.match(/(\d{1,2})\s*(Ñ‡|Ñ‡Ğ°Ñ)/);
      if (hr){
        const h = parseInt(hr[1],10);
        if (!isNaN(h)) return h*60;
      }
      return null;
    }

    function flyoverAnswer(minutesFromTakeoff){
      // Ğ”ĞµĞ¼Ğ¾: Ğ³Ñ€ÑƒĞ±Ñ‹Ğµ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ²Ğ°Ğ»Ñ‹
      if (minutesFromTakeoff == null){
        return `ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚: ĞšĞ°Ğ·Ğ°Ğ½ÑŒ â†’ ĞœĞ¾ÑĞºĞ²Ğ°.\nĞ•ÑĞ»Ğ¸ ÑĞºĞ°Ğ¶ĞµÑ‚Ğµ, ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾ Ñ Ğ²Ğ·Ğ»Ñ‘Ñ‚Ğ° â€” Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ¶Ñƒ, ĞºĞ°ĞºĞ¸Ğµ Ğ¾Ñ€Ğ¸ĞµĞ½Ñ‚Ğ¸Ñ€Ñ‹ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ÑÑ‚ÑÑ Ğ¿Ğ¾Ğ´ ĞºÑ€Ñ‹Ğ»Ğ¾Ğ¼.`;
      }

      if (minutesFromTakeoff <= 15){
        return `ĞšĞ°Ğ·Ğ°Ğ½ÑŒ â†’ ĞœĞ¾ÑĞºĞ²Ğ°.\nĞ¡ĞµĞ¹Ñ‡Ğ°Ñ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ ĞµÑ‰Ñ‘ Ñ€Ğ°Ğ¹Ğ¾Ğ½ Ğ¢Ğ°Ñ‚Ğ°Ñ€ÑÑ‚Ğ°Ğ½Ğ°: Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒĞ²Ğ¸Ğ´ĞµÑ‚ÑŒ Ğ¸Ğ·Ğ³Ğ¸Ğ±Ñ‹ Ğ’Ğ¾Ğ»Ğ³Ğ¸/ĞšĞ°Ğ¼Ñ‹ Ğ¸ Ğ¿Ğ¾Ğ»Ñ.\nĞÑ€Ğ¸ĞµĞ½Ñ‚Ğ¸Ñ€Ñ‹: Ğ¿Ñ€Ğ¸Ğ³Ğ¾Ñ€Ğ¾Ğ´ ĞšĞ°Ğ·Ğ°Ğ½Ğ¸, ĞºÑ€ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ´Ğ½Ñ‹Ğµ â€œĞ»ĞµĞ½Ñ‚Ñ‹â€ Ğ¸ Ñ€Ğ°Ğ·Ğ²ÑĞ·ĞºĞ¸.`;
      }
      if (minutesFromTakeoff <= 35){
        return `ĞšĞ°Ğ·Ğ°Ğ½ÑŒ â†’ ĞœĞ¾ÑĞºĞ²Ğ°.\nĞ§Ğ°ÑÑ‚Ğ¾ Ğ² ÑÑ‚Ğ¾Ğ¼ Ğ¾ĞºĞ½Ğµ Ğ¿Ğ¾Ğ¿Ğ°Ğ´Ğ°ÑÑ‚ Ñ€Ğ°Ğ¹Ğ¾Ğ½Ñ‹ Ğ§ÑƒĞ²Ğ°ÑˆĞ¸Ğ¸/ĞœĞ°Ñ€Ğ¸Ğ¹ Ğ­Ğ».\nĞÑ€Ğ¸ĞµĞ½Ñ‚Ğ¸Ñ€Ñ‹: Ğ§ĞµĞ±Ğ¾ĞºÑĞ°Ñ€Ñ‹ (ĞµÑĞ»Ğ¸ Ñ‡ÑƒÑ‚ÑŒ ÑĞ¶Ğ½ĞµĞµ Ñ‚Ñ€Ğ°ÑÑÑ‹), Ğ™Ğ¾ÑˆĞºĞ°Ñ€-ĞĞ»Ğ° (ĞµÑĞ»Ğ¸ ÑĞµĞ²ĞµÑ€Ğ½ĞµĞµ), ÑˆĞ¸Ñ€Ğ¾ĞºĞ°Ñ Ğ’Ğ¾Ğ»Ğ³Ğ°.`;
      }
      if (minutesFromTakeoff <= 60){
        return `ĞšĞ°Ğ·Ğ°Ğ½ÑŒ â†’ ĞœĞ¾ÑĞºĞ²Ğ°.\nĞ¡ĞµÑ€ĞµĞ´Ğ¸Ğ½Ğ° Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ°: Ñ‡Ğ°ÑÑ‚Ğ¾ â€œĞ¿Ğ¾Ğ´ ĞºÑ€Ñ‹Ğ»Ğ¾Ğ¼â€ Ñ€Ğ°Ğ¹Ğ¾Ğ½Ñ‹ ĞĞ¸Ğ¶ĞµĞ³Ğ¾Ñ€Ğ¾Ğ´ÑĞºĞ¾Ğ¹ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚Ğ¸.\nĞÑ€Ğ¸ĞµĞ½Ñ‚Ğ¸Ñ€Ñ‹: ĞĞ¸Ğ¶Ğ½Ğ¸Ğ¹ ĞĞ¾Ğ²Ğ³Ğ¾Ñ€Ğ¾Ğ´, ÑĞ»Ğ¸ÑĞ½Ğ¸Ğµ Ğ’Ğ¾Ğ»Ğ³Ğ¸ Ğ¸ ĞĞºĞ¸ (Ğ¾Ñ‡ĞµĞ½ÑŒ Ğ·Ğ°Ğ¼ĞµÑ‚Ğ½Ğ°Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°), ĞºÑ€ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ¼Ğ¾ÑÑ‚Ñ‹/Ğ¿ĞµÑ‚Ğ»Ğ¸ Ñ€ĞµĞºĞ¸.`;
      }
      if (minutesFromTakeoff <= 85){
        return `ĞšĞ°Ğ·Ğ°Ğ½ÑŒ â†’ ĞœĞ¾ÑĞºĞ²Ğ°.\nĞ‘Ğ»Ğ¸Ğ¶Ğµ Ğº Ñ„Ğ¸Ğ½Ğ°Ğ»Ñƒ Ñ‡Ğ°ÑÑ‚Ğ¾ Ğ¸Ğ´ÑƒÑ‚ Ğ’Ğ»Ğ°Ğ´Ğ¸Ğ¼Ğ¸Ñ€ÑĞºĞ°Ñ/ĞœĞ¾ÑĞºĞ¾Ğ²ÑĞºĞ°Ñ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚Ğ¸.\nĞÑ€Ğ¸ĞµĞ½Ñ‚Ğ¸Ñ€Ñ‹: Ğ’Ğ»Ğ°Ğ´Ğ¸Ğ¼Ğ¸Ñ€, Ğ´Ğ°Ğ»ĞµĞµ Ğ¿Ğ»Ğ¾Ñ‚Ğ½Ğ°Ñ ÑĞµÑ‚ĞºĞ° Ğ´Ğ¾Ñ€Ğ¾Ğ³ Ğ¸ Ğ½Ğ°ÑĞµĞ»Ñ‘Ğ½Ğ½Ñ‹Ñ… Ğ¿ÑƒĞ½ĞºÑ‚Ğ¾Ğ², Ğ¿ĞµÑ€ĞµĞ´ ĞœĞ¾ÑĞºĞ²Ğ¾Ğ¹ â€” â€œÑĞ¿Ğ»Ğ¾ÑˆĞ½Ğ¾Ğ¹ Ğ³Ğ¾Ñ€Ğ¾Ğ´â€.`;
      }
      return `ĞšĞ°Ğ·Ğ°Ğ½ÑŒ â†’ ĞœĞ¾ÑĞºĞ²Ğ°.\nĞ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ ~1:25 Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ğ·Ğ»Ñ‘Ñ‚Ğ°, Ğ²ĞµÑ€Ğ¾ÑÑ‚Ğ½Ğ¾ Ğ²Ñ‹ Ğ² Ğ·Ğ¾Ğ½Ğµ ÑĞ½Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğº ĞœĞ¾ÑĞºĞ²Ğµ.\nĞÑ€Ğ¸ĞµĞ½Ñ‚Ğ¸Ñ€Ñ‹: Ğ¿Ğ»Ğ¾Ñ‚Ğ½Ğ°Ñ Ğ·Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°, ĞºĞ¾Ğ»ÑŒÑ†ĞµĞ²Ñ‹Ğµ/Ğ¼Ğ°Ğ³Ğ¸ÑÑ‚Ñ€Ğ°Ğ»Ğ¸, ĞºÑ€ÑƒĞ¿Ğ½Ñ‹Ğµ Ğ²Ğ¾Ğ´Ğ¾Ñ‘Ğ¼Ñ‹ Ğ¸ Ñ€ĞµĞºĞ° ĞœĞ¾ÑĞºĞ²Ğ°.`;
    }

    // ====== Ğ¡Ñ‚Ğ°Ñ€Ñ‚ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸ĞµĞ² ======
    function startFlow(flow){
      state.activeFlow = flow;
      state.data = {};
      state.step = null;

      switch(flow){
        case 'watch':
          state.step = 'askDuration';
          aeroSay(
            'ĞŸĞ¾Ğ´Ğ±ĞµÑ€Ñƒ, Ñ‡Ñ‚Ğ¾ Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ. Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ½Ğ¾ Ğ»ĞµÑ‚ĞµÑ‚ÑŒ? ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ â€œ2:30â€ Ğ¸Ğ»Ğ¸ â€œ150 Ğ¼Ğ¸Ğ½ÑƒÑ‚â€.',
            [
              {label:'Ğ”Ğ¾ 1 Ñ‡Ğ°ÑĞ°', value:'~1Ñ‡'},
              {label:'1â€“2 Ñ‡Ğ°ÑĞ°', value:'~1-2Ñ‡'},
              {label:'2â€“4 Ñ‡Ğ°ÑĞ°', value:'~2-4Ñ‡'},
              {label:'Ğ‘Ğ¾Ğ»ÑŒÑˆĞµ 4 Ñ‡Ğ°ÑĞ¾Ğ²', value:'~4+Ñ‡'}
            ]
          );
          break;

        case 'sleep':
          state.step = 'sleepIntro';
          aeroSay(
            'Ğ¡Ğ´ĞµĞ»Ğ°ĞµĞ¼ ÑĞ¿Ğ¾ĞºĞ¾Ğ¹Ğ½Ñ‹Ğ¹ â€œÑĞ¿ÑƒÑĞºâ€ Ğ² ÑĞ¾Ğ½. Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ ĞµÑÑ‚ÑŒ?',
            [
              {label:'5 Ğ¼Ğ¸Ğ½ÑƒÑ‚', value:'5'},
              {label:'10 Ğ¼Ğ¸Ğ½ÑƒÑ‚', value:'10'},
              {label:'ĞŸÑ€Ğ¾ÑÑ‚Ğ¾ ÑĞ¾Ğ²ĞµÑ‚Ñ‹', value:'tips'}
            ]
          );
          break;

        case 'flyover':
          state.step = 'flyoverAskTime';
          // Ñ„Ğ¸ĞºÑĞ¸Ñ€ÑƒĞµĞ¼ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚ ÑÑ€Ğ°Ğ·Ñƒ
          state.data.route = 'ĞšĞ°Ğ·Ğ°Ğ½ÑŒ â†’ ĞœĞ¾ÑĞºĞ²Ğ°';
          aeroSay(
            'ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚: ĞšĞ°Ğ·Ğ°Ğ½ÑŒ â†’ ĞœĞ¾ÑĞºĞ²Ğ°. Ğ¡ĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ¾ Ñ Ğ²Ğ·Ğ»Ñ‘Ñ‚Ğ°? (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: â€œ20 Ğ¼Ğ¸Ğ½ÑƒÑ‚â€ Ğ¸Ğ»Ğ¸ â€œ0:45â€)'
          );
          break;

        case 'aircraft':
          state.step = 'aircraftFact';
          aeroSay(
            'ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ Ñ„Ğ°ĞºÑ‚: Ğ½Ğ° ĞºÑ€ĞµĞ¹ÑĞµÑ€ÑĞºĞ¾Ğ¼ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ğ»Ğ°Ğ¹Ğ½ĞµÑ€ Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ»ĞµÑ‚Ğ¸Ñ‚ Ğ½Ğ° Ğ²Ñ‹ÑĞ¾Ñ‚Ğµ Ğ¾ĞºĞ¾Ğ»Ğ¾ 10â€“12 ĞºĞ¼ â€” ÑÑ‚Ğ¾ Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ¾ Ñ€Ğ°ÑÑ…Ğ¾Ğ´Ñƒ Ñ‚Ğ¾Ğ¿Ğ»Ğ¸Ğ²Ğ° Ğ¸ Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğµ.',
            [
              {label:'Ğ•Ñ‰Ñ‘ Ñ„Ğ°ĞºÑ‚', value:'ĞµÑ‰Ñ‘'},
              {label:'ĞŸÑ€Ğ¾ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ', value:'ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ'},
              {label:'ĞŸÑ€Ğ¾ Ñ‚ÑƒÑ€Ğ±ÑƒĞ»ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ', value:'Ñ‚ÑƒÑ€Ğ±ÑƒĞ»ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ'}
            ]
          );
          break;

        case 'crew':
          state.step = 'crewPick';
            aeroSay(
    'Ğ§Ñ‚Ğ¾ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ñ€Ñ‚Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ½Ğ¸ĞºÑƒ?',
    [
      {label:'ĞŸÑ€Ğ¸Ğ½ĞµÑĞ¸Ñ‚Ğµ Ğ²Ğ¾Ğ´Ñƒ', value:'crew:water'},
      {label:'ĞÑƒĞ¶Ğ½Ğ° Ğ¿Ğ¾Ğ´ÑƒÑˆĞºĞ°', value:'crew:pillow'},
      {label:'Ğ—Ğ°ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ ÑƒĞ¶Ğ¸Ğ½', value:'crew:dinner'},
      {label:'ĞŸÑ€Ğ¸Ğ½ĞµÑĞ¸Ñ‚Ğµ Ğ´ĞµÑ‚ÑĞºĞ¾Ğµ Ğ¼ĞµĞ½Ñ', value:'crew:kids'}
    ]
  );
  break;
      }
    }

    // ====== ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ²Ğ²Ğ¾Ğ´Ğ° ======
    function handleUserInput(text){
      const trimmed = (text || '').trim();
      if (!trimmed) return;

      userSay(trimmed);

      // ĞµÑĞ»Ğ¸ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ Ğ½Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½ â€” Ğ¾Ğ±Ñ‰Ğ°Ñ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
      if (!state.activeFlow){
        const t = normalize(trimmed);
        if (t.includes('Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ') || t.includes('Ñ„Ğ¸Ğ»ÑŒĞ¼') || t.includes('ÑĞµÑ€Ğ¸Ğ°Ğ»')){
          startFlow('watch'); return;
        }
        if (t.includes('ÑƒÑĞ½ÑƒÑ‚ÑŒ') || t.includes('ÑĞ¾Ğ½')){
          startFlow('sleep'); return;
        }
        if (t.includes('Ğ¿Ñ€Ğ¾Ğ»ĞµÑ‚Ğ°ĞµĞ¼') || t.includes('Ğ³Ğ´Ğµ Ğ»ĞµÑ‚Ğ¸Ğ¼') || t.includes('Ğ½Ğ°Ğ´ Ñ‡ĞµĞ¼')){
          startFlow('flyover'); return;
        }
        if (t.includes('ÑĞ°Ğ¼Ğ¾Ğ»ĞµÑ‚') || t.includes('ÑĞ°Ğ¼Ğ¾Ğ»Ñ‘Ñ‚') || t.includes('Ñ‚ÑƒÑ€Ğ±ÑƒĞ»ĞµĞ½Ñ‚')){
          startFlow('aircraft'); return;
        }
        if (t.includes('Ğ±Ğ¾Ñ€Ñ‚Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´') || t.includes('Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰') || t.includes('Ğ¿Ğ»Ğ¾Ñ…Ğ¾')){
          startFlow('crew'); return;
        }

        aeroSay(
          'Ğ¯ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ñƒ Ğ² Ğ¿Ğ¾Ğ»Ñ‘Ñ‚Ğµ. ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ â€œ+â€ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸ĞµĞ² Ğ¸Ğ»Ğ¸ Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ: â€œÑ‡Ñ‚Ğ¾ Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ / ÑƒÑĞ½ÑƒÑ‚ÑŒ / Ñ‡Ñ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ»ĞµÑ‚Ğ°ĞµĞ¼ / Ñ„Ğ°ĞºÑ‚Ñ‹ Ğ¾ ÑĞ°Ğ¼Ğ¾Ğ»Ñ‘Ñ‚Ğµâ€.'
        );
        return;
      }

      // ===== FLOW: WATCH =====
      if (state.activeFlow === 'watch'){
        if (state.step === 'askDuration'){
          const d = parseDuration(trimmed);
          state.data.durationRaw = trimmed;
          state.data.duration = (d !== null) ? d : trimmed;
          state.data.bucket = durationToBucket(state.data.duration);

          state.step = 'askGenre';
          aeroSay(
            'ĞĞºĞµĞ¹. ĞšĞ°ĞºĞ¾Ğ¹ Ğ¶Ğ°Ğ½Ñ€ Ğ±ĞµÑ€Ñ‘Ğ¼?',
            [
              {label:'ĞšĞ¾Ğ¼ĞµĞ´Ğ¸Ñ', value:'ĞºĞ¾Ğ¼ĞµĞ´Ğ¸Ñ'},
              {label:'Ğ”ĞµÑ‚ĞµĞºÑ‚Ğ¸Ğ²/Ñ‚Ñ€Ğ¸Ğ»Ğ»ĞµÑ€', value:'Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ¸Ğ²'},
              {label:'Ğ”Ñ€Ğ°Ğ¼Ğ°', value:'Ğ´Ñ€Ğ°Ğ¼Ğ°'},
              {label:'Ğ¤Ğ°Ğ½Ñ‚Ğ°ÑÑ‚Ğ¸ĞºĞ°', value:'Ñ„Ğ°Ğ½Ñ‚Ğ°ÑÑ‚Ğ¸ĞºĞ°'}
            ]
          );
          return;
        }

        if (state.step === 'askGenre'){
          state.data.genre = trimmed;
          state.data.genreKey = genreToKey(trimmed);

          state.step = 'askFormat';
          aeroSay(
            'Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚: ÑĞµÑ€Ğ¸Ğ°Ğ» Ğ¸Ğ»Ğ¸ Ñ„Ğ¸Ğ»ÑŒĞ¼?',
            [
              {label:'Ğ¡ĞµÑ€Ğ¸Ğ°Ğ»', value:'ÑĞµÑ€Ğ¸Ğ°Ğ»'},
              {label:'Ğ¤Ğ¸Ğ»ÑŒĞ¼', value:'Ñ„Ğ¸Ğ»ÑŒĞ¼'}
            ]
          );
          return;
        }

        if (state.step === 'askFormat'){
          // Ñ„Ğ¸ĞºÑ: Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµĞ¼ Ğ¸ Ñ‡Ğ¸Ğ¿Ñ‹, Ğ¸ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚
          state.data.format = trimmed;
          state.data.formatKey = formatToKey(trimmed);

          const res = buildWatchResult(state.data.bucket, state.data.genreKey, state.data.formatKey);

          aeroSay(
            res + '\n\nĞ¥Ğ¾Ñ‚Ğ¸Ñ‚Ğµ â€œĞ¿Ğ¾Ğ»ĞµĞ³Ñ‡Ğµâ€ Ğ¸Ğ»Ğ¸ â€œĞ¿Ğ¾Ğ¶Ñ‘ÑÑ‚Ñ‡Ğµâ€? ĞœĞ¾Ğ³Ñƒ Ğ¿ĞµÑ€ĞµĞºĞ¸Ğ½ÑƒÑ‚ÑŒ Ğ½Ğ° Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€.',
            [
              {label:'ĞŸĞ¾Ğ»ĞµĞ³Ñ‡Ğµ', value:'Ğ¿Ğ¾Ğ»ĞµĞ³Ñ‡Ğµ'},
              {label:'ĞŸĞ¾Ğ¶Ñ‘ÑÑ‚Ñ‡Ğµ', value:'Ğ¿Ğ¾Ğ¶Ñ‘ÑÑ‚Ñ‡Ğµ'},
              {label:'Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¶Ğ°Ğ½Ñ€', value:'ÑĞ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ğ¶Ğ°Ğ½Ñ€'}
            ]
          );

          state.step = 'refine';
          return;
        }

        if (state.step === 'refine'){
          const t = normalize(trimmed);

          if (t.includes('ÑĞ¼ĞµĞ½Ğ¸Ñ‚ÑŒ')){
            state.step = 'askGenre';
            aeroSay('ĞĞºĞµĞ¹. ĞšĞ°ĞºĞ¾Ğ¹ Ğ¶Ğ°Ğ½Ñ€ Ñ‚ĞµĞ¿ĞµÑ€ÑŒ?', [
              {label:'ĞšĞ¾Ğ¼ĞµĞ´Ğ¸Ñ', value:'ĞºĞ¾Ğ¼ĞµĞ´Ğ¸Ñ'},
              {label:'Ğ”ĞµÑ‚ĞµĞºÑ‚Ğ¸Ğ²/Ñ‚Ñ€Ğ¸Ğ»Ğ»ĞµÑ€', value:'Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ¸Ğ²'},
              {label:'Ğ”Ñ€Ğ°Ğ¼Ğ°', value:'Ğ´Ñ€Ğ°Ğ¼Ğ°'},
              {label:'Ğ¤Ğ°Ğ½Ñ‚Ğ°ÑÑ‚Ğ¸ĞºĞ°', value:'Ñ„Ğ°Ğ½Ñ‚Ğ°ÑÑ‚Ğ¸ĞºĞ°'}
            ]);
            return;
          }

          if (t.includes('Ğ¿Ğ¾Ğ»ĞµĞ³Ñ‡')){
            // Ğ¿Ğ¾Ğ»ĞµĞ³Ñ‡Ğµ = ĞºĞ¾Ğ¼ĞµĞ´Ğ¸Ñ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
            const res = buildWatchResult(state.data.bucket, 'comedy', state.data.formatKey);
            aeroSay('ĞŸĞ¾Ğ»ĞµĞ³Ñ‡Ğµ â€” Ğ²Ğ¾Ñ‚ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚:\n' + res);
            return;
          }

          if (t.includes('Ğ¿Ğ¾Ğ¶ĞµÑÑ‚') || t.includes('Ğ¿Ğ¾Ğ¶Ñ‘ÑÑ‚')){
            // Ğ¿Ğ¾Ğ¶Ñ‘ÑÑ‚Ñ‡Ğµ = Ğ´ĞµÑ‚ĞµĞºÑ‚Ğ¸Ğ² Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
            const res = buildWatchResult(state.data.bucket, 'detective', state.data.formatKey);
            aeroSay('ĞŸĞ¾Ğ¶Ñ‘ÑÑ‚Ñ‡Ğµ â€” Ğ²Ğ¾Ñ‚ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚:\n' + res);
            return;
          }

          aeroSay('ĞŸĞ¾Ğ½ÑĞ». Ğ•ÑĞ»Ğ¸ ÑĞºĞ°Ğ¶ĞµÑ‚Ğµ â€œĞµÑ‰Ñ‘ 2 Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ°â€ â€” Ğ¿Ğ¾Ğ´ĞºĞ¸Ğ½Ñƒ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ Ğ½Ğ°Ğ±Ğ¾Ñ€.');
          return;
        }

        aeroSay('Ğ¡ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ: ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ»ĞµÑ‚ĞµÑ‚ÑŒ â†’ Ğ¶Ğ°Ğ½Ñ€ â†’ ÑĞµÑ€Ğ¸Ğ°Ğ»/Ñ„Ğ¸Ğ»ÑŒĞ¼.');
        return;
      }

      // ===== FLOW: SLEEP =====
      if (state.activeFlow === 'sleep'){
        const t = normalize(trimmed);

        if (state.step === 'sleepIntro'){
          if (t.includes('5')){
            state.step = 'sleep5';
            aeroSay(
              '5 Ğ¼Ğ¸Ğ½ÑƒÑ‚:\n1) Ğ’Ğ´Ğ¾Ñ… 4 ÑĞµĞºÑƒĞ½Ğ´Ñ‹.\n2) Ğ’Ñ‹Ğ´Ğ¾Ñ… 6 ÑĞµĞºÑƒĞ½Ğ´.\nĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ 8 Ñ†Ğ¸ĞºĞ»Ğ¾Ğ².\n\nĞŸĞ»ĞµÑ‡Ğ¸ Ğ²Ğ½Ğ¸Ğ·, Ñ‡ĞµĞ»ÑÑÑ‚ÑŒ Ñ€Ğ°ÑÑĞ»Ğ°Ğ±Ğ¸Ñ‚ÑŒ.\n\nĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ ĞµÑ‰Ñ‘ 2 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹?',
              [
                {label:'Ğ”Ğ°, ĞµÑ‰Ñ‘ 2', value:'ĞµÑ‰Ñ‘'},
                {label:'ĞĞµÑ‚, Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾', value:'Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾'}
              ]
            );
            return;
          }
          if (t.includes('10')){
            state.step = 'sleep10';
            aeroSay(
              '10 Ğ¼Ğ¸Ğ½ÑƒÑ‚:\nâ€¢ 2 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹ Ğ´Ñ‹Ñ…Ğ°Ğ½Ğ¸Ğµ 4â€“6\nâ€¢ 3 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹ Ñ€Ğ°ÑÑĞ»Ğ°Ğ±Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚ĞµĞ»Ğ°\nâ€¢ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ\n\nĞ¥Ğ¾Ñ‚Ğ¸Ñ‚Ğµ â€œÑ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³â€ Ğ¸Ğ»Ğ¸ â€œÑ Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°Ğ¼Ğ¸â€?',
              [
                {label:'Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³', value:'Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³'},
                {label:'Ğ¡ Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°Ğ¼Ğ¸', value:'Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ¸'}
              ]
            );
            return;
          }
          if (t.includes('ÑĞ¾Ğ²ĞµÑ‚') || t.includes('tips')){
            aeroSay(
              'Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ ÑĞ½Ğ°:\nâ€¢ ĞœĞ°ÑĞºĞ°/Ğ±ĞµÑ€ÑƒÑˆĞ¸\nâ€¢ ĞŸĞ»ĞµĞ´ Ğ¿Ğ¾Ğ´ Ğ¿Ğ¾ÑÑĞ½Ğ¸Ñ†Ñƒ\nâ€¢ Ğ¡ÑƒĞ¼ĞºĞ° Ğ¿Ğ¾Ğ´ ÑÑ‚ÑƒĞ¿Ğ½Ğ¸\nâ€¢ Ğ’Ğ¾Ğ´Ñƒ Ğ½ĞµĞ±Ğ¾Ğ»ÑŒÑˆĞ¸Ğ¼Ğ¸ Ğ³Ğ»Ğ¾Ñ‚ĞºĞ°Ğ¼Ğ¸\n\nĞ•ÑĞ»Ğ¸ Ğ²Ñ‹ Ñƒ Ğ¾ĞºĞ½Ğ°/Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ° â€” ÑĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ, Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ¶Ñƒ Ğ¿Ğ¾Ğ·Ñƒ.'
            );
            state.activeFlow = null; state.step = null; state.data = {};
            return;
          }

          aeroSay('Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚, 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¸Ğ»Ğ¸ â€œĞ¿Ñ€Ğ¾ÑÑ‚Ğ¾ ÑĞ¾Ğ²ĞµÑ‚Ñ‹â€.', [
            {label:'5 Ğ¼Ğ¸Ğ½ÑƒÑ‚', value:'5'},
            {label:'10 Ğ¼Ğ¸Ğ½ÑƒÑ‚', value:'10'},
            {label:'ĞŸÑ€Ğ¾ÑÑ‚Ğ¾ ÑĞ¾Ğ²ĞµÑ‚Ñ‹', value:'tips'}
          ]);
          return;
        }

        if (state.step === 'sleep5'){
          if (t.includes('ĞµÑ‰Ñ‘')){
            aeroSay(
              'Ğ•Ñ‰Ñ‘ 2 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹:\nĞ’Ğ´Ğ¾Ñ… 4 â€” Ğ²Ñ‹Ğ´Ğ¾Ñ… 8.\nĞ•ÑĞ»Ğ¸ ÑĞ±Ğ¸Ğ»Ğ¸ÑÑŒ â€” ÑĞ¿Ğ¾ĞºĞ¾Ğ¹Ğ½Ğ¾ Ğ½Ğ°Ñ‡Ğ½Ğ¸Ñ‚Ğµ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾.\n\nĞ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾.'
            );
            state.activeFlow = null; state.step = null; state.data = {};
            return;
          }
          if (t.includes('Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚')){
            aeroSay('ĞĞºĞµĞ¹. Ğ•ÑĞ»Ğ¸ Ğ¼Ñ‹ÑĞ»Ğ¸ Ğ¼ĞµÑˆĞ°ÑÑ‚ â€” ÑÑ‡Ğ¸Ñ‚Ğ°Ğ¹Ñ‚Ğµ Ğ²Ñ‹Ğ´Ğ¾Ñ…Ğ¸ Ğ¾Ñ‚ 1 Ğ´Ğ¾ 20 Ğ¸ ÑĞ½Ğ¾Ğ²Ğ° Ñ 1.');
            state.activeFlow = null; state.step = null; state.data = {};
            return;
          }
          aeroSay('ĞÑ‚Ğ²ĞµÑ‚ÑŒÑ‚Ğµ â€œĞµÑ‰Ñ‘â€ Ğ¸Ğ»Ğ¸ â€œĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾â€.');
          return;
        }

        if (state.step === 'sleep10'){
          if (t.includes('Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³') || t.includes('Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·')){
            aeroSay('Ğ¡ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ â€œÑÑ‚Ğ°Ñ€Ñ‚â€. Ğ¯ Ğ¿Ñ€Ğ¾Ğ²ĞµĞ´Ñƒ Ğ¿Ğ¾ ÑÑ‚Ğ°Ğ¿Ğ°Ğ¼ ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¼Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ÑĞ¼Ğ¸.');
            state.step = 'sleep10Start';
            return;
          }
          aeroSay('Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ â€œÑ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³â€ Ğ¸Ğ»Ğ¸ â€œÑ Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°Ğ¼Ğ¸â€.', [
            {label:'Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³', value:'Ñ‚Ğ°Ğ¹Ğ¼Ğ¸Ğ½Ğ³'},
            {label:'Ğ¡ Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ°Ğ¼Ğ¸', value:'Ğ¿Ğ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ¸'}
          ]);
          return;
        }

        if (state.step === 'sleep10Start'){
          if (t.includes('ÑÑ‚Ğ°Ñ€Ñ‚')){
            aeroSay('Ğ¡Ñ‚Ğ°Ñ€Ñ‚. 2 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹: Ğ²Ğ´Ğ¾Ñ… 4 â€” Ğ²Ñ‹Ğ´Ğ¾Ñ… 6.');
            setTimeout(() => aeroSay('Ğ”Ğ°Ğ»ÑŒÑˆĞµ. 3 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñ‹: Ñ€Ğ°ÑÑĞ»Ğ°Ğ±ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ± â†’ Ğ³Ğ»Ğ°Ğ·Ğ° â†’ Ñ‡ĞµĞ»ÑÑÑ‚ÑŒ â†’ Ğ¿Ğ»ĞµÑ‡Ğ¸ â†’ Ñ€ÑƒĞºĞ¸.'), 2200);
            setTimeout(() => aeroSay('Ğ¤Ğ¸Ğ½Ğ°Ğ». 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚: Ğ²Ğ¸Ğ·ÑƒĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ â€œÑ‚Ğ¸Ñ…Ğ¸Ğ¹ ĞºĞ¾Ñ€Ğ¸Ğ´Ğ¾Ñ€â€, ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑˆĞ°Ğ³ â€” Ğ²Ñ‹Ğ´Ğ¾Ñ….'), 4400);
            setTimeout(() => {
              aeroSay('Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾. Ğ•ÑĞ»Ğ¸ Ñ…Ğ¾Ñ‡ĞµÑ‚ÑÑ â€” Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚Ğµ Ñ„Ğ¸Ğ½Ğ°Ğ» ĞµÑ‰Ñ‘ 3â€“5 Ğ¼Ğ¸Ğ½ÑƒÑ‚.');
              state.activeFlow = null; state.step = null; state.data = {};
            }, 6600);
            return;
          }
          aeroSay('ĞĞ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ â€œÑÑ‚Ğ°Ñ€Ñ‚â€, ĞºĞ¾Ğ³Ğ´Ğ° Ğ±ÑƒĞ´ĞµÑ‚Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹.');
          return;
        }
      }

      // ===== FLOW: FLYOVER (KZN â†’ MOW) =====
      if (state.activeFlow === 'flyover'){
        if (state.step === 'flyoverAskTime'){
          const mins = parseMinutesLoose(trimmed);
          aeroSay(flyoverAnswer(mins), [
            {label:'ĞŸÑ€Ğ¾ÑˆĞ»Ğ¾ 20 Ğ¼Ğ¸Ğ½ÑƒÑ‚', value:'20 Ğ¼Ğ¸Ğ½ÑƒÑ‚'},
            {label:'ĞŸÑ€Ğ¾ÑˆĞ»Ğ¾ 45 Ğ¼Ğ¸Ğ½ÑƒÑ‚', value:'0:45'},
            {label:'ĞŸÑ€Ğ¾ÑˆĞ»Ğ¾ 1:10', value:'1:10'}
          ]);
          // Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑ‚ÑŒ flow Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¼ â€” Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑƒÑ‚Ğ¾Ñ‡Ğ½ÑÑ‚ÑŒ Ğ²Ñ€ĞµĞ¼Ñ
          return;
        }
      }

      // ===== FLOW: AIRCRAFT =====
      if (state.activeFlow === 'aircraft'){
        const t = normalize(trimmed);
        if (t.includes('ĞµÑ‰Ñ‘')){
          const facts = [
            'Ğ¢ÑƒÑ€Ğ±ÑƒĞ»ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ñ‡Ğ°Ñ‰Ğµ Ğ½ĞµĞ¿Ñ€Ğ¸ÑÑ‚Ğ½Ğ°, Ñ‡ĞµĞ¼ Ğ¾Ğ¿Ğ°ÑĞ½Ğ°: Ñ€ĞµĞ¼ĞµĞ½ÑŒ â€” Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ.',
            'ĞĞ° ÑÑˆĞµĞ»Ğ¾Ğ½Ğµ Ğ·Ğ° Ğ±Ğ¾Ñ€Ñ‚Ğ¾Ğ¼ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¾ĞºĞ¾Ğ»Ğ¾ âˆ’50Â°C â€” Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ ĞµÑÑ‚ÑŒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ Ğ¾Ğ±Ğ¾Ğ³Ñ€ĞµĞ²Ğ° Ğ¸ Ğ°Ğ½Ñ‚Ğ¸Ğ¾Ğ±Ğ»ĞµĞ´ĞµĞ½ĞµĞ½Ğ¸Ñ.',
            'ĞŸĞ»Ğ¾Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ Ğ²Ğ¾Ğ·Ğ´ÑƒÑ…Ğ° Ğ½Ğ° Ğ²Ñ‹ÑĞ¾Ñ‚Ğµ Ğ½Ğ¸Ğ¶Ğµ â€” Ğ¿Ğ¾ÑÑ‚Ğ¾Ğ¼Ñƒ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¸ Ñ€ĞµĞ¶Ğ¸Ğ¼Ñ‹ Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ÑÑ‚ Ğ¾Ñ‡ĞµĞ½ÑŒ Ñ‚Ğ¾Ñ‡Ğ½Ğ¾.',
            'ĞŸÑ€Ğ¸ Ğ¿Ğ¾ÑĞ°Ğ´ĞºĞµ ÑˆĞ°ÑÑĞ¸ Ğ¸ Ğ·Ğ°ĞºÑ€Ñ‹Ğ»ĞºĞ¸ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°ÑÑ‚ ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´ÑŠÑ‘Ğ¼Ğ½ÑƒÑ ÑĞ¸Ğ»Ñƒ Ğ¸ ÑĞ½Ğ¸Ğ·Ğ¸Ñ‚ÑŒ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ.'
          ];
          aeroSay(facts[Math.floor(Math.random()*facts.length)], [
            {label:'Ğ•Ñ‰Ñ‘ Ñ„Ğ°ĞºÑ‚', value:'ĞµÑ‰Ñ‘'},
            {label:'ĞŸÑ€Ğ¾ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ', value:'ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ'},
            {label:'Ğ—Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸Ñ‚ÑŒ', value:'Ğ·Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸Ñ‚ÑŒ'}
          ]);
          return;
        }
        if (t.includes('ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚')){
          aeroSay('ĞšÑ€ĞµĞ¹ÑĞµÑ€ÑĞºĞ°Ñ ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ñƒ Ğ»Ğ°Ğ¹Ğ½ĞµÑ€Ğ¾Ğ² Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ğ¾ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞ° 800â€“900 ĞºĞ¼/Ñ‡ (Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ Ñ‚Ğ¸Ğ¿Ğ° Ğ¸ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹). Ğ’ĞµÑ‚ĞµÑ€ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ·Ğ°Ğ¼ĞµÑ‚Ğ½Ğ¾ â€œÑƒÑĞºĞ¾Ñ€ÑÑ‚ÑŒâ€ Ğ¸Ğ»Ğ¸ â€œÑ‚Ğ¾Ñ€Ğ¼Ğ¾Ğ·Ğ¸Ñ‚ÑŒâ€ Ğ¿Ğ¾ Ğ·ĞµĞ¼Ğ»Ğµ.');
          return;
        }
        if (t.includes('Ñ‚ÑƒÑ€Ğ±ÑƒĞ»')){
          aeroSay('Ğ•ÑĞ»Ğ¸ Ñ‚Ñ€ÑÑÑ‘Ñ‚: Ñ€ĞµĞ¼ĞµĞ½ÑŒ Ğ¿Ñ€Ğ¸ÑÑ‚Ñ‘Ğ³Ğ½ÑƒÑ‚. Ğ­ĞºĞ¸Ğ¿Ğ°Ğ¶ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¼ĞµĞ½ÑÑ‚ÑŒ ÑÑˆĞµĞ»Ğ¾Ğ½/ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ñ‚ÑŒ Ğ·Ğ¾Ğ½Ñ‹ Ğ¿Ğ¾ Ğ¿Ğ¾Ğ³Ğ¾Ğ´Ğµ Ğ¸ Ğ´Ğ¾ĞºĞ»Ğ°Ğ´Ğ°Ğ¼.');
          return;
        }
        if (t.includes('Ğ·Ğ°ĞºĞ¾Ğ½Ñ‡')){
          aeroSay('ĞĞºĞµĞ¹. ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ â€œ+â€ â€” Ñ‚Ğ°Ğ¼ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸.');
          state.activeFlow = null; state.step = null; state.data = {};
          return;
        }
        aeroSay('Ğ¡ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ â€œĞµÑ‰Ñ‘â€, Ğ¸Ğ»Ğ¸ Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚ĞµĞ¼Ñƒ: ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ÑŒ / Ñ‚ÑƒÑ€Ğ±ÑƒĞ»ĞµĞ½Ñ‚Ğ½Ğ¾ÑÑ‚ÑŒ / Ğ·Ğ°ĞºĞ¾Ğ½Ñ‡Ğ¸Ñ‚ÑŒ.');
        return;
      }

      // ===== FLOW: CREW =====
if (state.activeFlow === 'crew'){
  if (state.step === 'crewPick'){
    const t = normalize(trimmed);

    // ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ñ‡Ğ¸Ğ¿Ğ¾Ğ² (crew:...) Ğ¸ ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµĞºÑÑ‚Ğ°
    let choice = null;

    if (t.includes('crew:water') || t.includes('Ğ²Ğ¾Ğ´Ñƒ')) choice = 'water';
    else if (t.includes('crew:pillow') || t.includes('Ğ¿Ğ¾Ğ´ÑƒÑˆ')) choice = 'pillow';
    else if (t.includes('crew:dinner') || t.includes('ÑƒĞ¶Ğ¸Ğ½')) choice = 'dinner';
    else if (t.includes('crew:kids') || t.includes('Ğ´ĞµÑ‚ÑĞº')) choice = 'kids';

    if (!choice){
      aeroSay(
        'Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¾Ğ´Ğ¸Ğ½ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚:',
        [
          {label:'ĞŸÑ€Ğ¸Ğ½ĞµÑĞ¸Ñ‚Ğµ Ğ²Ğ¾Ğ´Ñƒ', value:'crew:water'},
          {label:'ĞÑƒĞ¶Ğ½Ğ° Ğ¿Ğ¾Ğ´ÑƒÑˆĞºĞ°', value:'crew:pillow'},
          {label:'Ğ—Ğ°ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ ÑƒĞ¶Ğ¸Ğ½', value:'crew:dinner'},
          {label:'ĞŸÑ€Ğ¸Ğ½ĞµÑĞ¸Ñ‚Ğµ Ğ´ĞµÑ‚ÑĞºĞ¾Ğµ Ğ¼ĞµĞ½Ñ', value:'crew:kids'}
        ]
      );
      return;
    }

    const map = {
      water: 'ĞŸÑ€Ğ¸Ğ½ĞµÑĞ¸Ñ‚Ğµ Ğ²Ğ¾Ğ´Ñƒ',
      pillow: 'ĞÑƒĞ¶Ğ½Ğ° Ğ¿Ğ¾Ğ´ÑƒÑˆĞºĞ°',
      dinner: 'Ğ—Ğ°ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ ÑƒĞ¶Ğ¸Ğ½',
      kids: 'ĞŸÑ€Ğ¸Ğ½ĞµÑĞ¸Ñ‚Ğµ Ğ´ĞµÑ‚ÑĞºĞ¾Ğµ Ğ¼ĞµĞ½Ñ'
    };

    state.step = 'crewDone';

    aeroSay(
      `ĞŸÑ€Ğ¸Ğ½ÑÑ‚Ğ¾: Â«${map[choice]}Â». Ğ¥Ğ¾Ñ‚Ğ¸Ñ‚Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾ ĞµÑ‰Ñ‘?`,
      [
        {label:'Ğ•Ñ‰Ñ‘ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ', value:'ĞµÑ‰Ñ‘ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ'},
        {label:'Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾', value:'Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¾'}
      ]
    );
    return;
  }

  if (state.step === 'crewDone'){
    const t = normalize(trimmed);
    if (t.includes('ĞµÑ‰Ğµ') || t.includes('ĞµÑ‰Ñ‘')){
      state.step = 'crewPick';
      aeroSay(
        'Ğ§Ñ‚Ğ¾ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ñ€Ñ‚Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ½Ğ¸ĞºÑƒ?',
        [
          {label:'ĞŸÑ€Ğ¸Ğ½ĞµÑĞ¸Ñ‚Ğµ Ğ²Ğ¾Ğ´Ñƒ', value:'crew:water'},
          {label:'ĞÑƒĞ¶Ğ½Ğ° Ğ¿Ğ¾Ğ´ÑƒÑˆĞºĞ°', value:'crew:pillow'},
          {label:'Ğ—Ğ°ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ ÑƒĞ¶Ğ¸Ğ½', value:'crew:dinner'},
          {label:'ĞŸÑ€Ğ¸Ğ½ĞµÑĞ¸Ñ‚Ğµ Ğ´ĞµÑ‚ÑĞºĞ¾Ğµ Ğ¼ĞµĞ½Ñ', value:'crew:kids'}
        ]
      );
      return;
    }
    if (t.includes('Ğ³Ğ¾Ñ‚Ğ¾Ğ²')){
      aeroSay('Ğ¥Ğ¾Ñ€Ğ¾ÑˆĞ¾. Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ÑÑ â€” Ğ½Ğ°Ğ¿Ğ¸ÑˆĞ¸Ñ‚Ğµ, Ñ‡Ñ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾.');
      state.activeFlow = null; state.step = null; state.data = {};
      return;
    }

    aeroSay('ĞÑ‚Ğ²ĞµÑ‚ÑŒÑ‚Ğµ â€œĞµÑ‰Ñ‘ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñâ€ Ğ¸Ğ»Ğ¸ â€œĞ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¾â€.', [
      {label:'Ğ•Ñ‰Ñ‘ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ', value:'ĞµÑ‰Ñ‘ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ'},
      {label:'Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾', value:'Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¾'}
    ]);
    return;
  }

  // fallback
  state.step = 'crewPick';
  aeroSay(
    'Ğ§Ñ‚Ğ¾ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‚ÑŒ Ğ±Ğ¾Ñ€Ñ‚Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ½Ğ¸ĞºÑƒ?',
    [
      {label:'ĞŸÑ€Ğ¸Ğ½ĞµÑĞ¸Ñ‚Ğµ Ğ²Ğ¾Ğ´Ñƒ', value:'crew:water'},
      {label:'ĞÑƒĞ¶Ğ½Ğ° Ğ¿Ğ¾Ğ´ÑƒÑˆĞºĞ°', value:'crew:pillow'},
      {label:'Ğ—Ğ°ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ ÑƒĞ¶Ğ¸Ğ½', value:'crew:dinner'},
      {label:'ĞŸÑ€Ğ¸Ğ½ĞµÑĞ¸Ñ‚Ğµ Ğ´ĞµÑ‚ÑĞºĞ¾Ğµ Ğ¼ĞµĞ½Ñ', value:'crew:kids'}
    ]
  );
  return;
}
    }


    function send(){
      const text = inputEl.value.trim();
      if (!text) return;
      inputEl.value = '';
      handleUserInput(text);
    }

    sendEl.addEventListener('click', send);
    inputEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') send();
    });

    window.addEventListener('load', () => {
      inputEl.focus();
      messagesEl.scrollTop = messagesEl.scrollHeight;
    });

    window.addEventListener('resize', () => {
      requestAnimationFrame(() => {
        messagesEl.scrollTop = messagesEl.scrollHeight;
      });
    });
  </script>
</body>
</html>



